(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{345:function(a,s,t){"use strict";t.r(s);var e=t(13),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"_1-docker基础"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker基础"}},[a._v("#")]),a._v(" 1 Docker基础")]),a._v(" "),s("h3",{attrs:{id:"_1-1-docker核心组件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-docker核心组件"}},[a._v("#")]),a._v(" 1.1 Docker核心组件")]),a._v(" "),s("h4",{attrs:{id:"_1-1-1-docker引擎"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-docker引擎"}},[a._v("#")]),a._v(" 1.1.1 Docker引擎")]),a._v(" "),s("p",[a._v("Docker使用客户端-服务器架构，Docker客户端是用户与Docker交互的主要方式，与Docker守护进程（Docker引擎）进行通信。该守护进程完成了构建，运行和分发Docker容器的繁重工作，Docker客户端和守护程序可以在同一系统上运行，也可以将Docker客户端连接到远程Docker守护程序。Docker客户端和守护程序在UNIX套接字或网络接口上使用REST API进行通信。Docker守护进程侦听Docker API请求并管理Docker对象，例如镜像，容器，网络和卷等。守护程序还可以与其他守护程序通信以管理Docker服务")]),a._v(" "),s("h4",{attrs:{id:"_1-1-2-docker镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-docker镜像"}},[a._v("#")]),a._v(" 1.1.2 Docker镜像")]),a._v(" "),s("p",[a._v("Docker镜像类似于虚拟机镜像，可以将它理解为一个只读的模板。镜像是基于联合（Union）文件 系统的一种层式的结构，由一系列指令一步一步构建出来。镜像是创建Docker容器的基础。通过版本管理和增量的文件系统， Docker提供了一套十分简单的机制来创建和更新现有的镜像，用户可以从网上下载一个已经做好的应用镜像，并直接使用我们可以利用Dockerfile构建自己的镜像。")]),a._v(" "),s("h4",{attrs:{id:"_1-1-3-docker容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-docker容器"}},[a._v("#")]),a._v(" 1.1.3 Docker容器")]),a._v(" "),s("p",[a._v("Docker容器类似于一个轻量级的沙箱，Docker利用容器来运行和隔离应用。容器是镜像的一个运行实例。可以将其启动、开始、停止、删除，而这些容器都是彼此相互隔离的、互不可见的。 可以把容器看做是一个简易版的Linux系统环境（包括root用户权限、进程空间、用户空间和网络空间等）以及运行在其中的应用程序打包而成的盒子。容器是基于镜像启动起来的，容器中可以运行一个或多个进程。镜像是Docker生命周期中的构建或打包阶段，而容器则是启动或执行阶段。镜像自身是只读的。容器从镜像启动的时候，会在镜像的最上层创建一个可写层。")]),a._v(" "),s("h4",{attrs:{id:"_1-1-4-docker仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-4-docker仓库"}},[a._v("#")]),a._v(" 1.1.4 Docker仓库")]),a._v(" "),s("p",[a._v("Docker仓库类似于代码仓库，它是Docker集中存放镜像文件的场所。仓库注册服务器（Registry）是存放仓库的地方，其上往往存放着多个仓库。每个仓库集中存放某一类镜像，往往包括多个镜像文件，通过不同的标签（tag）来进行区分")]),a._v(" "),s("h3",{attrs:{id:"_1-2-docker安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-docker安装"}},[a._v("#")]),a._v(" 1.2 Docker安装")]),a._v(" "),s("h4",{attrs:{id:"_1-2-1-卸载历史版本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-卸载历史版本"}},[a._v("#")]),a._v(" 1.2.1 卸载历史版本")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看安装")]),a._v("\nyum list installed "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#卸载")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" remove containerd.io.x86_64\nyum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" remove docker-ce.x86_64\nyum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" remove docker-ce-cli.x86_64\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#删库")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" /var/lib/docker\n")])])]),s("h4",{attrs:{id:"_1-2-2-安装yum源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-安装yum源"}},[a._v("#")]),a._v(" 1.2.2 安装yum源")]),a._v(" "),s("p",[a._v("官方源：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" yum-utils\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n")])])]),s("p",[a._v("阿里源：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-O")]),a._v(" /etc/yum.repos.d/docker-ce.repo\n")])])]),s("h4",{attrs:{id:"_1-2-3-安装docker引擎"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-安装docker引擎"}},[a._v("#")]),a._v(" 1.2.3 安装Docker引擎")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" docker-ce docker-ce-cli containerd.io\n")])])]),s("h4",{attrs:{id:"_1-2-4-配置docker镜像加速"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-4-配置docker镜像加速"}},[a._v("#")]),a._v(" 1.2.4 配置docker镜像加速")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /etc/docker\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" /etc/docker/daemon.json "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<-")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'EOF\'\n{\n  "registry-mirrors": ["https://29pj73ca.mirror.aliyuncs.com"]\n}\nEOF')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl daemon-reload\n")])])]),s("h4",{attrs:{id:"_1-2-5-启动docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-5-启动docker"}},[a._v("#")]),a._v(" 1.2.5 启动Docker")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#开机启动")]),a._v("\nsystemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#启动")]),a._v("\nsystemctl start "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看Docker状态")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" info\n")])])]),s("h2",{attrs:{id:"_2-docker操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-docker操作"}},[a._v("#")]),a._v(" 2 Docker操作")]),a._v(" "),s("h3",{attrs:{id:"_2-1-docker常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-docker常用命令"}},[a._v("#")]),a._v(" 2.1 Docker常用命令")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" version "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 版本信息")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" info    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 显示docker系统信息，包括镜像和容器数量")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--help")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 帮助命令")]),a._v("\n")])])]),s("h3",{attrs:{id:"_2-2-使用docker镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-使用docker镜像"}},[a._v("#")]),a._v(" 2.2 使用Docker镜像")]),a._v(" "),s("h4",{attrs:{id:"_2-2-1-获取镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-获取镜像"}},[a._v("#")]),a._v(" 2.2.1 获取镜像")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("：TAG"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" （拉取最新的镜像）\n")])])]),s("p",[a._v("描述一个镜像需要包括“名称+标签”信息\n例如:")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull mysql:5.7.30\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker pull mysql:5.7.30")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.7")]),a._v(".30: Pulling from library/mysql\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 镜像文件一般由若干层（layer）组成 层的唯一id镜像文件一般由若干层（layer）组成")]),a._v("\n8559a31e96f4: Pull complete\nd51ce1c2e575: Pull complete\nc2344adc4858: Pull complete\nfcf3ceff18fc: Pull complete\n16da0c38dc5b: Pull complete\nb905d1797e97: Pull complete\n4b50d1c6b05c: Pull complete\nd85174a87144: Pull complete\na4ad33703fa8: Pull complete\nf7a5433ce20d: Pull complete\n3dcd2a278b4a: Pull complete\n")])])]),s("p",[a._v("如果不显式指定TAG，则默认会选择latest标签，这会下载仓库中最新版本的镜像。\n镜像的仓库名称中还应该添加仓库地址（即registry，注册服务器）作为前缀，默认使用的是Docker Hub服务，该前缀可以忽略。")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull registry.hub.docker.com/mysql:5.7.30\n")])])]),s("p",[a._v("如果从非官方的仓库下载，则需要在仓库名称前指定完整的仓库地址。")]),a._v(" "),s("h4",{attrs:{id:"_2-2-2-查看镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-查看镜像"}},[a._v("#")]),a._v(" 2.2.2 查看镜像")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" images\n")])])]),s("h4",{attrs:{id:"_2-2-3-添加镜像标签"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-添加镜像标签"}},[a._v("#")]),a._v(" 2.2.3 添加镜像标签")]),a._v(" "),s("p",[a._v("docker tag [原镜像名:tag号] [目标镜像名:tag号] # 如果tag号缺省，默认latest")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker tag mysql:5.7.30 mysql5")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@localhost ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker images")]),a._v("\nREPOSITORY TAG IMAGE ID CREATED SIZE\nmysql5 latest 9cfcce23593a "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),a._v(" weeks ago 448MB\nmysql "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5.7")]),a._v(".30 9cfcce23593a "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),a._v(" weeks ago 448MB\n")])])]),s("h4",{attrs:{id:"_2-2-3-查看镜像详细信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-查看镜像详细信息"}},[a._v("#")]),a._v(" 2.2.3 查看镜像详细信息")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" inspect NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("：TAG"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),s("h4",{attrs:{id:"_2-2-4-搜寻镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-搜寻镜像"}},[a._v("#")]),a._v(" 2.2.4 搜寻镜像")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" search 名称\n")])])]),s("h4",{attrs:{id:"_2-2-5-删除镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-删除镜像"}},[a._v("#")]),a._v(" 2.2.5 删除镜像")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("docker rmi NAME[：TAG]")]),a._v(":当同一个镜像拥有多个标签的时候，docker rmi命令只是删除该镜像多个标签中的指定标签而已，并不影响镜像文件。当镜像只剩下一个标签的时候,使用docker rmi命令会彻底删除镜像")]),a._v(" "),s("li",[s("code",[a._v("docker rmi IMAGE ID")]),a._v(":使用镜像ID删除镜像")])]),a._v(" "),s("p",[a._v("如果有容器正在运行该镜像，则不能删除。如果想强行删除用 -f (不推荐)")]),a._v(" "),s("h4",{attrs:{id:"_2-2-6-上传镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-6-上传镜像"}},[a._v("#")]),a._v(" 2.2.6 上传镜像")]),a._v(" "),s("p",[s("code",[a._v("docker push NAME[:TAG]")]),a._v(":上传镜像到仓库，默认上传到Docker Hub官方仓库（需要登录）")]),a._v(" "),s("h3",{attrs:{id:"_2-3-操作docker容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-操作docker容器"}},[a._v("#")]),a._v(" 2.3 操作Docker容器")]),a._v(" "),s("h4",{attrs:{id:"_2-3-1-创建容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-创建容器"}},[a._v("#")]),a._v(" 2.3.1 创建容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" create NAME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(":TAG"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),s("p",[a._v("可以加选项参数")]),a._v(" "),s("ul",[s("li",[a._v("-i 交互模式")]),a._v(" "),s("li",[a._v("-t 伪终端")]),a._v(" "),s("li",[a._v("-d 后台运行")]),a._v(" "),s("li",[a._v("-rm 容器退出后是否自动删除")])]),a._v(" "),s("p",[a._v("例如：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" nginx\n")])])]),s("h4",{attrs:{id:"_2-3-2-启动容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-启动容器"}},[a._v("#")]),a._v(" 2.3.2 启动容器")]),a._v(" "),s("p",[s("code",[a._v("docker start 容器id")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" start 9cfcce23593a\n")])])]),s("p",[a._v("查看容器状态")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" 查看运行的容器\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看运行的容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看所有容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v("\n")])])]),s("h4",{attrs:{id:"_2-3-3-新建并启动容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-新建并启动容器"}},[a._v("#")]),a._v(" 2.3.3 新建并启动容器")]),a._v(" "),s("p",[a._v("docker run NAME[:TAG]：相当于 docker create+docker start")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--network")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("host")]),a._v(" redis\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 参数说明")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"name"')]),a._v("  容器名字\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v("             后台方式运行\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v("            使用交互方式运行，进入容器查看内容\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("             指定容器的端口 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(":8080\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" ip:主机端口:容器端口\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" 主机端口:容器端口\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" 容器端口\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v("             随机指定端口\n")])])]),s("p",[a._v("可以加选项参数：\n--network host 使用宿主机IP地址\n查看命令帮助信息：\nman docker run\ndocker run --help")]),a._v(" "),s("h4",{attrs:{id:"_2-3-4-终止容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-4-终止容器"}},[a._v("#")]),a._v(" 2.3.4 终止容器")]),a._v(" "),s("p",[a._v("docker stop 容器id -t 时间（默认10秒）")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" stop ce554267d7a4 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("kill")]),a._v(" ce554267d7a4\n")])])]),s("h4",{attrs:{id:"_2-3-5-重启容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-5-重启容器"}},[a._v("#")]),a._v(" 2.3.5 重启容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" restart ce5\n")])])]),s("h4",{attrs:{id:"_2-3-6-进入容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-6-进入容器"}},[a._v("#")]),a._v(" 2.3.6 进入容器")]),a._v(" "),s("p",[a._v("docker exec -it [容器ID] /bin/bash\n无论在容器内进行何种操作，依据依据镜像创建的其他容器都不会受影响(由于namespace的隔离)（将数据持久化的除外） exec: 容器执行某操作，操作为容器ID后边的命令 -it: 以伪终端模式，这样我们就相当于进入到容器中了")]),a._v(" "),s("h4",{attrs:{id:"_2-3-7-退出容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-7-退出容器"}},[a._v("#")]),a._v(" 2.3.7 退出容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exit")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 直接容器停止并退出")]),a._v("\nCtrl + p + q  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 容器不停止退出")]),a._v("\n")])])]),s("h4",{attrs:{id:"_2-3-8-查看容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-8-查看容器"}},[a._v("#")]),a._v(" 2.3.8 查看容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" inspect "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("容器ID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),s("h4",{attrs:{id:"_2-3-9-删除容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-9-删除容器"}},[a._v("#")]),a._v(" 2.3.9 删除容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("容器ID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),s("h3",{attrs:{id:"_2-4-docker容器常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-docker容器常用命令"}},[a._v("#")]),a._v(" 2.4 Docker容器常用命令")]),a._v(" "),s("h4",{attrs:{id:"_2-4-1-查看容器日志信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-1-查看容器日志信息"}},[a._v("#")]),a._v(" 2.4.1 查看容器日志信息")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" logs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("OPTIONS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" CONTAINER\n")])])]),s("h4",{attrs:{id:"_2-4-2-查看容器中进程信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-2-查看容器中进程信息"}},[a._v("#")]),a._v(" 2.4.2 查看容器中进程信息")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 命令 docker top 容器id")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker top 66e")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("UID")]),a._v("                 PID                 "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PPID")]),a._v("                C                   STIME               TTY                 TIME                CMD\npolkitd             "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3359")]),a._v("                "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3339")]),a._v("                "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("                   "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("16")]),a._v(":51               pts/0               00:00:00            redis-server *:6379\n")])])]),s("h4",{attrs:{id:"_2-4-3-进入正在运行的容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-3-进入正在运行的容器"}},[a._v("#")]),a._v(" 2.4.3 进入正在运行的容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 方式一：进入容器后开启一个新的终端")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" 容器id bashShell\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 方式二：进入容器正在执行的终端")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" attach 容器id\n")])])]),s("h4",{attrs:{id:"_2-4-4-从容器内拷贝文件到主机上"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-4-从容器内拷贝文件到主机上"}},[a._v("#")]),a._v(" 2.4.4 从容器内拷贝文件到主机上")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" 容器id:源文件路径 目标路径\n")])])]),s("h4",{attrs:{id:"_2-4-5-commit镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-5-commit镜像"}},[a._v("#")]),a._v(" 2.4.5 commit镜像")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" commit 提交容器成为一个新的副本\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 命令和git原理类似")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" commit "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"描述信息"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"作者"')]),a._v(" 容器id 目标镜像名:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("TAG"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),s("p",[a._v("实例：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 1.启动一个默认tomcat")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -it -p 3344:8080 tomcat:9.0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 2.拷贝文件到webapps中，默认镜像中webapps中没有文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker exec -it 29 /bin/bash")]),a._v("\nroot@29a85a627874:/usr/local/tomcat"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cp -r webapps.dist/* webapps")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 3.commit提交容器成为一个镜像")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('# docker commit -a="mylsaber" -m="add webapps app" 29a85a627874 itomcat:1.0')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker images")]),a._v("\nREPOSITORY   TAG       IMAGE ID       CREATED         SIZE\nitomcat      "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.0")]),a._v("       e12236548928   "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),a._v(" seconds ago   685MB\n")])])]),s("h2",{attrs:{id:"_3-数据卷-data-volumes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-数据卷-data-volumes"}},[a._v("#")]),a._v(" 3 数据卷（data volumes）")]),a._v(" "),s("h3",{attrs:{id:"_3-1-数据卷容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-数据卷容器"}},[a._v("#")]),a._v(" 3.1 数据卷容器")]),a._v(" "),s("p",[a._v("容器内数据直接映射到宿主机目录")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# redis数据绑定到/home/redis/data下，配置文件绑定到/home/redis/conf下")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/redis/data:/data "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/redis/conf:/usr/local/etc/redis redis redis-server /usr/local/etc/redis/redis.conf\n")])])]),s("h3",{attrs:{id:"_3-2-数据卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-数据卷"}},[a._v("#")]),a._v(" 3.2 数据卷")]),a._v(" "),s("p",[a._v("由Docker创建和管理，是一个可供容器使用的特殊目录，它将主机操作系统目录直接映射进容器")]),a._v(" "),s("h4",{attrs:{id:"_3-2-1-特性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-特性"}},[a._v("#")]),a._v(" 3.2.1 特性")]),a._v(" "),s("ul",[s("li",[a._v("可以在容器之间共享和复用")]),a._v(" "),s("li",[a._v("对数据卷内数据修改立马生效")]),a._v(" "),s("li",[a._v("对数据卷更新不会影响镜像")]),a._v(" "),s("li",[a._v("卷会一直存在，直到没有容器使用时，可以安全卸载它")])]),a._v(" "),s("h4",{attrs:{id:"_3-2-2-创建方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-创建方式"}},[a._v("#")]),a._v(" 3.2.2 创建方式")]),a._v(" "),s("p",[s("strong",[a._v("具名挂载：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 卷命令帮助")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--help")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 显示创建卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除数据卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 挂载数据卷到容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" volume:/etc/nginx ngnix\n")])])]),s("p",[s("strong",[a._v("匿名挂载：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /data "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" redis-2 redis\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看所有容器卷")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v("\n")])])]),s("p",[s("strong",[a._v("多个容器间共享数据：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 通过--volumes-form可以实现多个容器数据的共享，只要有一个容器还存在，数据都不会删除")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber volumes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -it --rm --name centos01 mylsaber/centos:1.0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber volumes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -it --rm --name centos02 --volumes-from centos01 mylsaber/centos:1.0")]),a._v("\n")])])]),s("p",[a._v("所有的docker容器内的卷，没有指定目录的情况下都是在/var/lib/docker/volumes/xxx/_data。\n我们通过具名挂载可以方便的找到需要的卷，大多数情况下都是使用具名挂载。")]),a._v(" "),s("h4",{attrs:{id:"_3-2-3-拓展"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-拓展"}},[a._v("#")]),a._v(" 3.2.3 拓展")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 通过-v容器内路径 ：ro rw 改变读写权限")]),a._v("\nro "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("readonly")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#只读，只能通过宿主机写，容器无法写")]),a._v("\nrw readwrite "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#读写，默认rw")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" volume1:/etc/nginx:ro nginx\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" volume1:/etc/nginx:rw nginx\n")])])]),s("h3",{attrs:{id:"_3-3-实战-安装mysql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-实战-安装mysql"}},[a._v("#")]),a._v(" 3.3 实战：安装MySQL")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# dockerhub官方启动命令")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" some-mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("my-secret-pw "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" mysql:tag\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 挂载mysql目录")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber home"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -d --rm -p 3306:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root mysql:5.7")]),a._v("\n")])])]),s("h2",{attrs:{id:"_4-dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-dockerfile"}},[a._v("#")]),a._v(" 4 DockerFile")]),a._v(" "),s("h3",{attrs:{id:"_4-1-dockerfile概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-dockerfile概念"}},[a._v("#")]),a._v(" 4.1 DockerFile概念")]),a._v(" "),s("p",[a._v("DockerFile就是用来构建docker镜像的构建文件！命令脚本！\n构建步骤：")]),a._v(" "),s("ol",[s("li",[a._v("编写一个dockerfile文件")]),a._v(" "),s("li",[a._v("docker build 构建成为一个镜像")]),a._v(" "),s("li",[a._v("docker run 运行镜像")]),a._v(" "),s("li",[a._v("docker push 发布镜像（docker hub，阿里云镜像仓库等）")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" 源dockerfile "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" 目标镜像名 保存地址 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 目录中有默认名Dockerfile文件时，可省略源dockerfile名")]),a._v("\n")])])]),s("h3",{attrs:{id:"_4-2-基础知识"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-基础知识"}},[a._v("#")]),a._v(" 4.2 基础知识")]),a._v(" "),s("ol",[s("li",[a._v("每个保留关键字（指令）都必须是大写字母")]),a._v(" "),s("li",[a._v("从上到下执行")]),a._v(" "),s("li",[a._v("#表示注释")]),a._v(" "),s("li",[a._v("每个指令都会创建提交一个新的镜像层")])]),a._v(" "),s("p",[a._v("dockerfile是面向开发的，发布项目，做镜像，就需要编写dockerfile文件。docke镜像逐渐成为企业交付标准")]),a._v(" "),s("h3",{attrs:{id:"_4-3-dockerfile基本指令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-dockerfile基本指令"}},[a._v("#")]),a._v(" 4.3 DockerFile基本指令")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("FROM          "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#用于为映像文件构建过程指定基准镜像，后续的指令运行于此基准镜像所提供的运行环境<digest>为校验码")]),a._v("\nFROM "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("repository"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(":"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("tag"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" 或者 FROM "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("repository"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("@"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("digest"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" \n\nMAINTANIER    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#用于让镜像制作者提供本人的详细信息 姓名+邮箱")]),a._v("\nMAINTAINER jiangfangwei"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("mylsaber@163.com"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\nLABEL         "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#LABEL用于为镜像添加元数据，元数以键值对的形式指定")]),a._v("\nLABEL "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1.0"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("description")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"web服务器"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("Autor")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"mylsaber"')]),a._v("\n\nRUN           "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#用于指定 docker build过程中运行的程序，其可以是任何命令，但是这里有个限定，一般为基础镜像可以运行的命令，如基础镜像为centos，安装软件命令为yum而不是ubuntu里的apt-get命令")]),a._v("\nRUN "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("command"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("或 RUN "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<executable>"')]),a._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<param1>"')]),a._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<param2>"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\nADD           "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#ADD指令类似于COPY指令，ADD支持使用tar文件和url路径")]),a._v("\nADD "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("src"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(". "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("dest"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("或ADD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<src>"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(". "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<dest>"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\nWORKDIR       "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#镜像的工作目录,指当前容器环境的工作目录，用于为 Dockerfile中所有的 RUN、CMD、ENTRYPOINT、COPY和 ADD指定设定工作目录")]),a._v("\n\nVOLUME        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#挂载目录")]),a._v("\nVOLUME "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("mountpoint"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("或VOLUME "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<mountpoint>"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\nEXPOST        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#暴露指定端口，用于为容器打开指定要监听的端口以实现与外部通信")]),a._v("\nEXPOSE "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("port"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("protocol"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("port"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("/"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("protocol"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\nCMD           "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#指定容器启动时运行的命令，只有最后一个会生效，可被替代")]),a._v("\nCMD "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("command"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("或CMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<executable>"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<param1>"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<param2>"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("或CMD"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<param1>"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<param2>"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\nENTRYPOINT    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#指定容器启动时运行的命令，可以追加命令")]),a._v("\nENTRYPOINT "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("command"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("或ENTRYPOINT "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<excutable>"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<param1>"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<param2>"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\nONBUILD       "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#当构建一个被继承DockerFile时，触发指令")]),a._v("\n\nCOPY          "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#用于从 Docker主机复制文件至创建的新映像文件")]),a._v("\nCOPY "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("src"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(". "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("dest"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("或 COPY "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<src>"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(". "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"<dest>"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n\nENV           "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#用于为镜像定义所需的环境变量，并可被 Dockerfile文件中位于其后的其它指令（如 ENV、ADD、COPY等）所调用 ，即先定义后调用,调用格式为 $variable_name或${variable_name}")]),a._v("\nENV "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("key"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("value"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("或 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" ENV "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("key"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("value"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n第一种格式中， "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("key"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("之后的所有内容均会被视作其 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("value"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("的组成部分，因此一次只能设置一个变量\n第二种格式，可用一次设置多个变量，每个变量为一个“"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("key"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("value"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("”的键值对，如果"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("value"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("包含空格，可以以反斜线（"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("）进行转义，也可通过对"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("value"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("加引号进行标识；另外反斜线也可以用于续行；定义多个变量时，建议使用第二种方式，以便在同一层中完成所有功能\n")])])]),s("h3",{attrs:{id:"_4-4-实战测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-实战测试"}},[a._v("#")]),a._v(" 4.4 实战测试")]),a._v(" "),s("p",[a._v("Docker Hub中大多数镜像都是从scratch继承。")]),a._v(" "),s("h4",{attrs:{id:"_4-4-1-centos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-centos"}},[a._v("#")]),a._v(" 4.4.1 centos")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber dockerfiles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# cat mydockerfile ")]),a._v("\nFROM centos\nMAINTAINER jiangfangwei"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("mylsaber@163.com"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\nENV MYPATH /user/local\nWORKDIR "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$MYPATH")]),a._v("\n\nRUN yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v("\nRUN yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" net-tools\n\nEXPOSE "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("\n\nCMD "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$MYPATH")]),a._v("\nCMD "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"----end----"')]),a._v("\nCMD /bin/bash\n")])])]),s("h4",{attrs:{id:"_4-4-2-tomcat镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-2-tomcat镜像"}},[a._v("#")]),a._v(" 4.4.2 Tomcat镜像")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#准备好jdk和tomcat安装包")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#编写dockerfile文件，官方命名Dockerfile")]),a._v("\nFROM centos\nMAINTAINET jiangfangwei"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("mylsaber@163.com"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\nCOPY readme.txt /usr/local/readme.txt\n\nADD jdk-8u311-linux-x64.tar.gz /usr/local\nADD apache-tomcat-9.0.56.tar.gz /usr/local\n\nRUN yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v("\n\nENV MYPATH /usr/local\nWORKDIR "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$MYPATH")]),a._v("\n\nENV JAVA_HOME /usr/local/jdk1.8.0_311\nENV CLASSPATH "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_HOME")]),a._v("/lib/dt.jar:"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_HOME")]),a._v("/lib/tools.jar\nENV CATALINA_HOME /usr/local/apache-tomcat-9.0.56\nENV CATALINA_BASE /usr/local/apache-tomcat-9.0.56\nENV "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("PATH")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[a._v("$PATH")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$JAVA_HOME")]),a._v("/bin:"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$CATALINA_HOME")]),a._v("/lib:"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$CATALINA_HOME")]),a._v("/bin\n\nEXPOSE "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v("\n\nCMD /usr/local/apache-tomcat-9.0.56/bin/startup.sh "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tail")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-F")]),a._v(" /usr/local/apache-tomcat-9.0.56/bin/logs/catalina.out\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#构建镜像")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" mytomcat:1.0 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])])]),s("h4",{attrs:{id:"_4-4-3-推送到阿里镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-3-推送到阿里镜像"}},[a._v("#")]),a._v(" 4.4.3 推送到阿里镜像")]),a._v(" "),s("p",[a._v("登录阿里云，选择控制台，选择容器镜像服务，新建命名空间，创建镜像仓库")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("#登录阿里云Docker Registry\ndocker login --username=username registry.cn-hangzhou.aliyuncs.com\ndocker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/mylsaber/tomcat:[镜像版本号]\ndocker push registry.cn-hangzhou.aliyuncs.com/mylsaber/tomcat:[镜像版本号]\n")])])]),s("p",[a._v("docker history 镜像id")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber dockerfiles"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker history redis")]),a._v("\nIMAGE          CREATED       CREATED BY                                      SIZE      COMMENT\n7614ae9453d1   "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" weeks ago   /bin/sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('#(nop)  CMD ["redis-server"]         0B        ')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("missing"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" weeks ago   /bin/sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#(nop)  EXPOSE 6379                  0B        ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("missing"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" weeks ago   /bin/sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('#(nop)  ENTRYPOINT ["docker-entry…   0B        ')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("missing"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" weeks ago   /bin/sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#(nop) COPY file:df205a0ef6e6df89…   374B      ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("missing"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" weeks ago   /bin/sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#(nop) WORKDIR /data                 0B        ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("missing"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" weeks ago   /bin/sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#(nop)  VOLUME [/data]               0B        ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("missing"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" weeks ago   /bin/sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /data "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chown")]),a._v(" redis:redis …   0B        \n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("missing"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" weeks ago   /bin/sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" -eux"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("   "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("savedAptMark")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"$(apt-m…   27.8MB    \n<missing>      4 weeks ago   /bin/sh -c #(nop)  ENV REDIS_DOWNLOAD_SHA=5b…   0B        \n<missing>      4 weeks ago   /bin/sh -c #(nop)  ENV REDIS_DOWNLOAD_URL=ht…   0B        \n<missing>      4 weeks ago   /bin/sh -c #(nop)  ENV REDIS_VERSION=6.2.6      0B        \n<missing>      4 weeks ago   /bin/sh -c set -eux;  savedAptMark="')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("$(")]),a._v("apt-ma…   "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(".24MB    \n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("missing"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" weeks ago   /bin/sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#(nop)  ENV GOSU_VERSION=1.12        0B        ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("missing"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" weeks ago   /bin/sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("groupadd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-g")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("999")]),a._v(" redis "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" usera…   329kB     \n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("missing"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" weeks ago   /bin/sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('#(nop)  CMD ["bash"]                 0B        ')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("missing"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" weeks ago   /bin/sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#(nop) ADD file:09675d11695f65c55…   80.4MB")]),a._v("\n")])])]),s("h2",{attrs:{id:"_5-docker网络"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-docker网络"}},[a._v("#")]),a._v(" 5 Docker网络")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" tomcat01 tomcat\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看容器内部网络地址ip addr")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" tomcat01 "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ip")]),a._v(" addr\n")])])]),s("p",[a._v("我们每启动一个docker容器，docker就会给容器分配一个ip，我们只要安装了docker，就会有一个docker0桥接模式，使用的技术是evth-pair技术。--link就是在hosts中增加一个地址映射")]),a._v(" "),s("h3",{attrs:{id:"_5-1-自定义网络"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-自定义网络"}},[a._v("#")]),a._v(" 5.1 自定义网络")]),a._v(" "),s("h4",{attrs:{id:"_5-1-1-网络模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-网络模式"}},[a._v("#")]),a._v(" 5.1.1 网络模式")]),a._v(" "),s("ul",[s("li",[a._v("bridge：桥接docker（默认）")]),a._v(" "),s("li",[a._v("none：不配置网络")]),a._v(" "),s("li",[a._v("host：和宿主机共享网络")]),a._v(" "),s("li",[a._v("container：容器网络连通（少用，局限大）")])]),a._v(" "),s("h4",{attrs:{id:"_5-1-2-测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-测试"}},[a._v("#")]),a._v(" 5.1.2 测试")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 我们直接启动命令默认自动加了 --net bridge，这个就是我们的docker0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" tomcat01 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--net")]),a._v(" bridge tomcat\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 自定义网络")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber tomcat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动两个在自定义网络上的tomcat")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber tomcat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -d -P --rm --net mynet --name tomcat01 tomcat")]),a._v("\n9b9ad5cabdae141dbc9dda14100d34a5405b5616f9fc975749ed292f9c4afd2d\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber tomcat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -d -P --rm --net mynet --name tomcat02 tomcat")]),a._v("\n16dc26f04265f78cce37d1d2ccbb4b7465f6eac813f600f6de5c5e0b0baf9313\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#可以相互ping通")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber tomcat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker exec -it tomcat01 ping tomcat02")]),a._v("\nPING tomcat02 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("56")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("84")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" bytes of data.\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("64")]),a._v(" bytes from tomcat02.mynet "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(": "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("64")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.200")]),a._v(" ms\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("64")]),a._v(" bytes from tomcat02.mynet "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(": "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("64")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.087")]),a._v(" ms\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber tomcat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker exec -it tomcat02 ping tomcat01")]),a._v("\nPING tomcat01 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("56")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("84")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" bytes of data.\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("64")]),a._v(" bytes from tomcat01.mynet "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(": "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("64")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.056")]),a._v(" ms\n")])])]),s("h4",{attrs:{id:"_5-1-2-连接网络"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-连接网络"}},[a._v("#")]),a._v(" 5.1.2 连接网络")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 默认docker0启动，无法ping通mynet下的容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber tomcat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker run -d -P --rm --name tomcat03 tomcat")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 可以通过docker network connect连接mynet，实现方式通过给容器再增加一个ip地址")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("root@mylsaber tomcat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker network connect mynet tomcat03")]),a._v("\n")])])]),s("h3",{attrs:{id:"_5-2-实战-部署redis集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-实战-部署redis集群"}},[a._v("#")]),a._v(" 5.2 实战：部署redis集群")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建网卡")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" network create redis "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--subnet")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("172.38")]),a._v(".0.0、16\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 通过脚本创建redis配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[a._v("port")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("seq")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /mydata/redis/node-"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${port}")]),a._v("/conf\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("touch")]),a._v(" /mydata/redis/node-"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${port}")]),a._v("/conf/redis.conf\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF"),s("span",{pre:!0,attrs:{class:"token bash punctuation"}},[a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/mydata/redis/node-"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${port}")]),a._v("/conf/redis.conf")]),a._v("\nport 6379 \nbind 0.0.0.0\ncluster-enabled yes \ncluster-config-file nodes.conf\ncluster-node-timeout 5000\ncluster-announce-ip 172.38.0.1"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${port}")]),a._v("\ncluster-announce-port 6379\ncluster-announce-bus-port 16379\nappendonly yes\nEOF")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启动redis")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6374")]),a._v(":6379 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("16374")]),a._v(":16379 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" redis-4 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /mydata/redis/node-4/data:/data "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /mydata/redis/node-4/conf/redis.conf:/etc/redis/redis.conf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--net")]),a._v(" redis "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--ip")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("172.38")]),a._v(".0.14 redis redis-server /etc/redis/redis.conf\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建集群")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379")]),a._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);