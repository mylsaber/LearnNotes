(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{337:function(a,s,t){"use strict";t.r(s);var e=t(13),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"_1-概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-概述"}},[a._v("#")]),a._v(" 1 概述")]),a._v(" "),s("p",[a._v("在前面已经提到，容器的生命周期可能很短，会被频繁的创建和销毁。那么容器在销毁的时候，保存在容器中的数据也会被清除。这种结果对用户来说，在某些情况下是不乐意看到的。为了持久化保存容器中的数据，kubernetes引入了Volume的概念。\nVolume是Pod中能够被多个容器访问的共享目录，它被定义在Pod上，然后被一个Pod里面的多个容器挂载到具体的文件目录下，kubernetes通过Volume实现同一个Pod中不同容器之间的数据共享以及数据的持久化存储。Volume的生命周期不和Pod中的单个容器的生命周期有关，当容器终止或者重启的时候，Volume中的数据也不会丢失。\nkubernetes的Volume支持多种类型，比较常见的有下面的几个：")]),a._v(" "),s("ul",[s("li",[a._v("简单存储：EmptyDir、HostPath、NFS。")]),a._v(" "),s("li",[a._v("高级存储：PV、PVC。")]),a._v(" "),s("li",[a._v("配置存储：ConfigMap、Secret。")])]),a._v(" "),s("h1",{attrs:{id:"_2-基本存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-基本存储"}},[a._v("#")]),a._v(" 2 基本存储")]),a._v(" "),s("h2",{attrs:{id:"_2-1-emptydir"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-emptydir"}},[a._v("#")]),a._v(" 2.1 EmptyDir")]),a._v(" "),s("h3",{attrs:{id:"_2-1-1-概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-概述"}},[a._v("#")]),a._v(" 2.1.1 概述")]),a._v(" "),s("p",[a._v("EmptyDir是最基础的Volume类型，一个EmptyDir就是Host上的一个空目录。\nEmptyDir是在Pod被分配到Node时创建的，它的初始内容为空，并且无须指定宿主机上对应的目录文件，因为kubernetes会自动分配一个目录，当Pod销毁时，EmptyDir中的数据也会被永久删除。\nEmptyDir的用途如下：")]),a._v(" "),s("ul",[s("li",[a._v("临时空间，例如用于某些应用程序运行时所需的临时目录，且无须永久保留。")]),a._v(" "),s("li",[a._v("一个容器需要从另一个容器中获取数据的目录（多容器共享目录）。")])]),a._v(" "),s("p",[a._v("接下来，通过一个容器之间的共享案例来使用描述一个EmptyDir。\n在一个Pod中准备两个容器nginx和busybox，然后声明一个volume分别挂载到两个容器的目录中，然后nginx容器负责向volume中写日志，busybox中通过命令将日志内容读到控制台。")]),a._v(" "),s("h3",{attrs:{id:"_2-1-2-创建pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-创建pod"}},[a._v("#")]),a._v(" 2.1.2 创建Pod")]),a._v(" "),s("p",[s("strong",[a._v("创建volume-emptydir.yaml文件：")])]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" volume"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("emptydir\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("1.17.1\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("imagePullPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" IfNotPresent\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumeMounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将logs-volume挂载到nginx容器中对应的目录，该目录为/var/log/nginx")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("volume\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mountPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /var/log/nginx\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" busybox\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" busybox"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1.30")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("imagePullPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" IfNotPresent\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/bin/sh"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-c"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"tail -f /logs/access.log"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 初始命令，动态读取指定文件")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumeMounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将logs-volume挂载到busybox容器中的对应目录，该目录为/logs")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("volume\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mountPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /logs\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 声明volume，name为logs-volume，类型为emptyDir")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("volume\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("emptyDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[s("strong",[a._v("创建pod：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" volume-emptydir.yaml\n")])])]),s("h3",{attrs:{id:"_2-2-3-查看pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-查看pod"}},[a._v("#")]),a._v(" 2.2.3 查看pod")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl get pod volume-emptydir "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" dev "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" wide\n")])])]),s("h3",{attrs:{id:"_2-2-4-查看指定容器的输出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-查看指定容器的输出"}},[a._v("#")]),a._v(" 2.2.4 查看指定容器的输出")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl logs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" volume-emptydir "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" dev "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" busybox\n")])])]),s("h3",{attrs:{id:"_2-2-5-访问pod中nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-访问pod中nginx"}},[a._v("#")]),a._v(" 2.2.5 访问pod中nginx")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("curl 10.244.1.173\n")])])]),s("p",[a._v("每当我们访问容器，指定容器的输出就会有log输出。")]),a._v(" "),s("h2",{attrs:{id:"_2-2-hostpath"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-hostpath"}},[a._v("#")]),a._v(" 2.2 HostPath")]),a._v(" "),s("h3",{attrs:{id:"_2-2-1-概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-概述"}},[a._v("#")]),a._v(" 2.2.1 概述")]),a._v(" "),s("p",[a._v("我们已经知道EmptyDir中的数据不会被持久化，它会随着Pod的结束而销毁，如果想要简单的将数据持久化到主机中，可以选择HostPath。\nHostPath就是将Node主机中的一个实际目录挂载到Pod中，以供容器使用，这样的设计就可以保证Pod销毁了，但是数据依旧可以保存在Node主机上。")]),a._v(" "),s("h3",{attrs:{id:"_2-2-2-创建pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-创建pod"}},[a._v("#")]),a._v(" 2.2.2 创建Pod")]),a._v(" "),s("p",[s("strong",[a._v("创建volume-hostpath.yaml文件：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: volume-hostpath\n  namespace: dev\nspec:\n  containers:\n    - name: nginx\n      image: nginx:1.17.1\n      imagePullPolicy: IfNotPresent\n      ports:\n        - containerPort: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("\n      volumeMounts: "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将logs-volume挂载到nginx容器中对应的目录，该目录为/var/log/nginx")]),a._v("\n        - name: logs-volume\n          mountPath: /var/log/nginx\n    - name: busybox\n      image: busybox:1.30\n      imagePullPolicy: IfNotPresent\n      command: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/bin/sh"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-c"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"tail -f /logs/access.log"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 初始命令，动态读取指定文件")]),a._v("\n      volumeMounts: "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将logs-volume挂载到busybox容器中的对应目录，该目录为/logs")]),a._v("\n        - name: logs-volume\n          mountPath: /logs\n  volumes: "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 声明volume，name为logs-volume，类型为hostPath")]),a._v("\n    - name: logs-volume\n      hostPath:\n        path: /root/logs\n        type: DirectoryOrCreate "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 目录存在就使用，不存在就先创建再使用")]),a._v("\n")])])]),s("blockquote",[s("p",[a._v("type的值的说明：")]),a._v(" "),s("ul",[s("li",[a._v("DirectoryOrCreate：目录存在就使用，不存在就先创建后使用。")]),a._v(" "),s("li",[a._v("Directory：目录必须存在。")]),a._v(" "),s("li",[a._v("FileOrCreate：文件存在就使用，不存在就先创建后使用。")]),a._v(" "),s("li",[a._v("File：文件必须存在。")]),a._v(" "),s("li",[a._v("Socket：unix套接字必须存在。")]),a._v(" "),s("li",[a._v("CharDevice：字符设备必须存在。")]),a._v(" "),s("li",[a._v("BlockDevice：块设备必须存在。")])])]),a._v(" "),s("p",[s("strong",[a._v("创建Pod：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" volume-hostpath.yaml\n")])])]),s("h3",{attrs:{id:"_2-2-3-查看pod-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-查看pod-2"}},[a._v("#")]),a._v(" 2.2.3 查看Pod")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl get pod volume-hostpath "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" dev "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" wide\n")])])]),s("h3",{attrs:{id:"_2-2-4-访问pod中的nginx"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-访问pod中的nginx"}},[a._v("#")]),a._v(" 2.2.4 访问Pod中的Nginx")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.244")]),a._v(".1.173\n")])])]),s("h3",{attrs:{id:"_2-2-5-在node节点中映射的目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-在node节点中映射的目录"}},[a._v("#")]),a._v(" 2.2.5 在node节点中映射的目录")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tail")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" /root/logs/access.log\n")])])]),s("h2",{attrs:{id:"_2-3-nfs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-nfs"}},[a._v("#")]),a._v(" 2.3 NFS")]),a._v(" "),s("h3",{attrs:{id:"_2-3-1-概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-概述"}},[a._v("#")]),a._v(" 2.3.1 概述")]),a._v(" "),s("p",[a._v("HostPath虽然可以解决数据持久化的问题，但是一旦Node节点故障了，Pod如果转移到别的Node节点上，又会出现问题，此时需要准备单独的网络存储系统，比较常用的是NFS和CIFS。\nNFS是一个网络文件存储系统，可以搭建一台NFS服务器，然后将Pod中的存储直接连接到NFS系统上，这样，无论Pod在节点上怎么转移，只要Node和NFS的对接没有问题，数据就可以成功访问。")]),a._v(" "),s("h3",{attrs:{id:"_2-3-2-搭建nfs服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-搭建nfs服务器"}},[a._v("#")]),a._v(" 2.3.2 搭建NFS服务器")]),a._v(" "),s("p",[a._v("首先需要准备NFS服务器，这里为了简单，直接在Master节点做NFS服务器。\n"),s("strong",[a._v("在Master节点上安装NFS服务器：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" nfs-utils rpcbind\n")])])]),s("p",[s("strong",[a._v("准备一个共享目录：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-pv")]),a._v(" /root/data/nfs\n")])])]),s("p",[s("strong",[a._v("将共享目录以读写权限暴露给")]),s("code",[a._v("**192.168.18.0/24**")]),s("strong",[a._v("网段中的所有主机：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/exports\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("/root/data/nfs "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".18.0/24"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("rw,no_root_squash"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[s("strong",[a._v("修改权限：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("777")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-R")]),a._v(" /root/data/nfs\n")])])]),s("p",[s("strong",[a._v("加载配置：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("exportfs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v("\n")])])]),s("p",[s("strong",[a._v("启动nfs服务：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("systemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" rpcbind "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--now")]),a._v("\nsystemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" nfs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--now")]),a._v("\n")])])]),s("p",[s("strong",[a._v("在Master节点测试是否成功：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("showmount "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".18.100\n")])])]),s("p",[s("strong",[a._v("在Node节点上都安装NFS服务器，目的是为了Node节点可以驱动NFS设备：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 在Node节点上安装NFS服务，不需要启动")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" nfs-utils\n")])])]),s("p",[s("strong",[a._v("在Node节点测试是否挂载成功：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("showmount "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".18.100\n")])])]),s("p",[s("strong",[a._v("高可用备份方式，在所有节点执行如下的命令：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mount")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v("  nfs "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".18.100:/root/data/nfs /mnt\n")])])]),s("h3",{attrs:{id:"_2-3-3-创建pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-创建pod"}},[a._v("#")]),a._v(" 2.3.3 创建Pod")]),a._v(" "),s("p",[s("strong",[a._v("创建volume-nfs.yaml文件：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: volume-nfs\n  namespace: dev\nspec:\n  containers:\n    - name: nginx\n      image: nginx:1.17.1\n      imagePullPolicy: IfNotPresent\n      ports:\n        - containerPort: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("\n      volumeMounts: "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将logs-volume挂载到nginx容器中对应的目录，该目录为/var/log/nginx")]),a._v("\n        - name: logs-volume\n          mountPath: /var/log/nginx\n    - name: busybox\n      image: busybox:1.30\n      imagePullPolicy: IfNotPresent\n      command: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/bin/sh"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-c"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"tail -f /logs/access.log"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 初始命令，动态读取指定文件")]),a._v("\n      volumeMounts: "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将logs-volume挂载到busybox容器中的对应目录，该目录为/logs")]),a._v("\n        - name: logs-volume\n          mountPath: /logs\n  volumes: "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 声明volume")]),a._v("\n    - name: logs-volume\n      nfs:\n        server: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".18.100 "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# NFS服务器地址")]),a._v("\n        path: /root/data/nfs "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 共享文件路径")]),a._v("\n")])])]),s("p",[s("strong",[a._v("创建Pod：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" volume-nfs.yaml\n")])])]),s("h3",{attrs:{id:"_2-3-4-查看pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-4-查看pod"}},[a._v("#")]),a._v(" 2.3.4 查看Pod")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl get pod volume-nfs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" dev\n")])])]),s("h3",{attrs:{id:"_2-3-5-查看nfs服务器上共享目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-5-查看nfs服务器上共享目录"}},[a._v("#")]),a._v(" 2.3.5 查看nfs服务器上共享目录")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" /root/data/nfs\n")])])]),s("h1",{attrs:{id:"_3-高级存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-高级存储"}},[a._v("#")]),a._v(" 3 高级存储")]),a._v(" "),s("h2",{attrs:{id:"_3-1-pv和pvc概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-pv和pvc概述"}},[a._v("#")]),a._v(" 3.1 PV和PVC概述")]),a._v(" "),s("p",[a._v("前面我们已经学习了使用NFS提供存储，此时就要求用户会搭建NFS系统，并且会在yaml配置nfs。由于kubernetes支持的存储系统有很多，要求客户全部掌握，显然不现实。为了能够屏蔽底层存储实现的细节，方便用户使用，kubernetes引入了PV和PVC两种资源对象。\nPV（Persistent Volume）是持久化卷的意思，是对底层的共享存储的一种抽象。一般情况下PV由kubernetes管理员进行创建和配置，它和底层具体的共享存储技术有关，并通过插件完成和共享存储的对接。\nPVC（Persistent Volume Claim）是持久化卷声明的意思，是用户对于存储需求的一种声明。换言之，PVC其实就是用户向kubernetes系统发出的一种资源需求申请。\n使用PV和PVC之后，工作可以得到进一步的提升：")]),a._v(" "),s("ul",[s("li",[a._v("存储：存储工程师维护。")]),a._v(" "),s("li",[a._v("PV：Kubernetes管理员维护。")]),a._v(" "),s("li",[a._v("PVC：Kubernetes用户维护。")])]),a._v(" "),s("h2",{attrs:{id:"_3-2-pv"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-pv"}},[a._v("#")]),a._v(" 3.2 PV")]),a._v(" "),s("h3",{attrs:{id:"_3-2-1-pv的资源清单文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-pv的资源清单文件"}},[a._v("#")]),a._v(" 3.2.1 PV的资源清单文件")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" PersistentVolume\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" pv2\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nfs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 存储类型，和底层正则的存储对应")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("capacity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 存储能力，目前只支持存储空间的设置")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 2Gi\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("accessModes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 访问模式")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storageClassName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 存储类别")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("persistentVolumeReclaimPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 回收策略")]),a._v("\n")])])]),s("p",[a._v("pv的关键配置参数说明：")]),a._v(" "),s("ul",[s("li",[a._v("存储类型：地产实际存储的类型，Kubernetes支持多种存储类型，每种存储类型的配置有所不同。")]),a._v(" "),s("li",[a._v("存储能力（capacity）：目前支持存储空间的设置（storage=1Gi)。")]),a._v(" "),s("li",[a._v("访问模式（accessModes）：用来描述用户应用对存储资源的访问权限\n"),s("ul",[s("li",[a._v("ReadWriteOnce（RWO）：读写权限，但是只能被单节点挂载。")]),a._v(" "),s("li",[a._v("ReadOnlyMany（ROX）：只读权限，可以被多个节点挂载。")]),a._v(" "),s("li",[a._v("ReadWriteMany（RWX）：读写权限，可以被多个节点挂载。")])])])]),a._v(" "),s("p",[a._v("需要注意的是，底层不同的存储类型可能支持的访问模式不同。")]),a._v(" "),s("ul",[s("li",[a._v("回收策略（persistentVolumeReclaimPolicy）：当PV不再被使用之后，对其的处理方式。\n"),s("ul",[s("li",[a._v("Retain（保留）：保留数据，需要管理员手动清理数据。")]),a._v(" "),s("li",[a._v("Recycle（回收）：清除PV中的数据，效果相当于"),s("code",[a._v("rm -rf /volume/*")])]),a._v(" "),s("li",[a._v("Delete（删除）：和PV相连的后端存储完成volume的删除操作，常见于云服务厂商的存储服务。")])])])]),a._v(" "),s("p",[a._v("需要注意的是，底层不同的存储类型可能支持的回收策略不同。")]),a._v(" "),s("ul",[s("li",[a._v("存储类别（storageClassName）：PV可以通过storageClassName参数指定一个存储类别。\n"),s("ul",[s("li",[a._v("具有特定类型的PV只能和请求了该类别的PVC进行绑定。")]),a._v(" "),s("li",[a._v("未设定类别的PV只能和不请求任何类别的PVC进行绑定。")])])]),a._v(" "),s("li",[a._v("状态（status）：一个PV的生命周期，可能会处于4种不同的阶段。\n"),s("ul",[s("li",[a._v("Available（可用）：表示可用状态，还未被任何PVC绑定。")]),a._v(" "),s("li",[a._v("Bound（已绑定）：表示PV已经被PVC绑定。")]),a._v(" "),s("li",[a._v("Released（已释放）：表示PVC被删除，但是资源还没有被集群重新释放。")]),a._v(" "),s("li",[a._v("Failed（失败）：表示该PV的自动回收失败。")])])])]),a._v(" "),s("h3",{attrs:{id:"_3-2-2-准备nfs环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-准备nfs环境"}},[a._v("#")]),a._v(" 3.2.2 准备NFS环境")]),a._v(" "),s("p",[s("strong",[a._v("创建目录：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-pv")]),a._v(" /root/data/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("pv1,pv2,pv3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[s("strong",[a._v("授权：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("777")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-R")]),a._v(" /root/data\n")])])]),s("p",[s("strong",[a._v("修改")]),s("code",[a._v("**/etc/exports**")]),s("strong",[a._v("文件：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/exports\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("/root/data/pv1     "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".18.0/24"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("rw,no_root_squash"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" \n/root/data/pv2     "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".18.0/24"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("rw,no_root_squash"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" \n/root/data/pv3     "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".18.0/24"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("rw,no_root_squash"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[s("strong",[a._v("重启nfs服务：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("systemctl restart nfs\n")])])]),s("h3",{attrs:{id:"_3-2-3-创建pv"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-创建pv"}},[a._v("#")]),a._v(" 3.2.3 创建PV")]),a._v(" "),s("p",[a._v("创建pv.yaml文件：")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" PersistentVolume\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" pv1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nfs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 存储类型吗，和底层正则的存储对应")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /root/data/pv1\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 192.168.18.100\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("capacity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 存储能力，目前只支持存储空间的设置")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 1Gi\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("accessModes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 访问模式")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ReadWriteMany\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("persistentVolumeReclaimPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Retain "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 回收策略")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("---")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" PersistentVolume\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" pv2\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nfs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 存储类型吗，和底层正则的存储对应")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /root/data/pv2\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 192.168.18.100\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("capacity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 存储能力，目前只支持存储空间的设置")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 2Gi\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("accessModes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 访问模式")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ReadWriteMany\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("persistentVolumeReclaimPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Retain "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 回收策略")]),a._v("\n  \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("---")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" PersistentVolume\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" pv3\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nfs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 存储类型吗，和底层正则的存储对应")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /root/data/pv3\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 192.168.18.100\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("capacity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 存储能力，目前只支持存储空间的设置")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 3Gi\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("accessModes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 访问模式")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ReadWriteMany\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("persistentVolumeReclaimPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Retain "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 回收策略")]),a._v("\n")])])]),s("p",[s("strong",[a._v("创建PV：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" pv.yaml\n")])])]),s("h3",{attrs:{id:"_3-2-4-查看pv"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-查看pv"}},[a._v("#")]),a._v(" 3.2.4 查看PV")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl get "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("pv")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" wide\n")])])]),s("h2",{attrs:{id:"_3-3-pvc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-pvc"}},[a._v("#")]),a._v(" 3.3 PVC")]),a._v(" "),s("h3",{attrs:{id:"_3-3-1-pvc的资源清单文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-pvc的资源清单文件"}},[a._v("#")]),a._v(" 3.3.1 PVC的资源清单文件")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" PersistentVolumeClaim\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" pvc\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("accessModes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 访客模式")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" \n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 采用标签对PV选择")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storageClassName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 存储类别")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 请求空间")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 5Gi\n")])])]),s("p",[a._v("PVC的关键配置参数说明：")]),a._v(" "),s("ul",[s("li",[a._v("访客模式（accessModes）：用于描述用户对存储资源的访问权限。")]),a._v(" "),s("li",[a._v("选择条件（selector）：通过Label Selector的设置，可使PVC对于系统中已存在的PV进行筛选。")]),a._v(" "),s("li",[a._v("存储类别（storageClassName）：PVC在定义时可以设定需要的后端存储的类别，只有设置了该class的pv才能被系统选出。")]),a._v(" "),s("li",[a._v("资源请求（resources）：描述对存储资源的请求。")])]),a._v(" "),s("h3",{attrs:{id:"_3-3-2-创建pvc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-创建pvc"}},[a._v("#")]),a._v(" 3.3.2 创建PVC")]),a._v(" "),s("p",[s("strong",[a._v("创建pvc.yaml文件：")])]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" PersistentVolumeClaim\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" pvc1\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("accessModes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 访客模式")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ReadWriteMany\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 请求空间")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 1Gi\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("---")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" PersistentVolumeClaim\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" pvc2\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("accessModes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 访客模式")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ReadWriteMany\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 请求空间")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 1Gi\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("---")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" PersistentVolumeClaim\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" pvc3\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("accessModes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 访客模式")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ReadWriteMany\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("resources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 请求空间")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 5Gi\n")])])]),s("p",[s("strong",[a._v("创建PVC：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" pvc.yaml\n")])])]),s("h3",{attrs:{id:"_3-3-3-查看pvc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-查看pvc"}},[a._v("#")]),a._v(" 3.3.3 查看PVC")]),a._v(" "),s("p",[s("strong",[a._v("查看PVC：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl get pvc "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" dev "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" wide\n")])])]),s("p",[s("strong",[a._v("查看PV：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl get "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("pv")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" wide\n")])])]),s("h3",{attrs:{id:"_3-3-4-创建pod使用pvc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-4-创建pod使用pvc"}},[a._v("#")]),a._v(" 3.3.4 创建Pod使用PVC")]),a._v(" "),s("p",[s("strong",[a._v("创建pvc-pod.yaml文件：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: pod1\n  namespace: dev\nspec:\n  containers:\n  - name: busybox\n    image: busybox:1.30\n    command: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/bin/sh"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-c"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"while true;do echo pod1 >> /root/out.txt; sleep 10; done;"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    volumeMounts:\n    - name: volume\n      mountPath: /root/\n  volumes:\n    - name: volume\n      persistentVolumeClaim:\n        claimName: pvc1\n        readOnly: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n\n---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pod2\n  namespace: dev\nspec:\n  containers:\n    - name: busybox\n      image: busybox:1.30\n      command: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/bin/sh"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-c"')]),a._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"while true;do echo pod1 >> /root/out.txt; sleep 10; done;"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n      volumeMounts:\n        - name: volume\n          mountPath: /root/\n  volumes:\n    - name: volume\n      persistentVolumeClaim:\n        claimName: pvc2\n        readOnly: "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n")])])]),s("p",[s("strong",[a._v("创建Pod：")])]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[a._v("kubectl create "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("f pvc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("pod.yaml\n")])])]),s("h3",{attrs:{id:"_3-3-5-创建pod使用pvc后查看pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-5-创建pod使用pvc后查看pod"}},[a._v("#")]),a._v(" 3.3.5 创建Pod使用PVC后查看Pod")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl get pod "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" dev "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" wide\n")])])]),s("h3",{attrs:{id:"_3-3-6-创建pod使用pvc后查看pvc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-6-创建pod使用pvc后查看pvc"}},[a._v("#")]),a._v(" 3.3.6 创建Pod使用PVC后查看PVC")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl get pvc "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" dev "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" wide\n")])])]),s("h3",{attrs:{id:"_3-3-7-创建pod使用pvc后查看pv"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-7-创建pod使用pvc后查看pv"}},[a._v("#")]),a._v(" 3.3.7 创建Pod使用PVC后查看PV")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl get "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("pv")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" dev "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" wide\n")])])]),s("h3",{attrs:{id:"_3-3-8-查看nfs中的文件存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-8-查看nfs中的文件存储"}},[a._v("#")]),a._v(" 3.3.8 查看nfs中的文件存储")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" /root/data/pv1/out.txt\n")])])]),s("h2",{attrs:{id:"_3-4-生命周期"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-生命周期"}},[a._v("#")]),a._v(" 3.4 生命周期")]),a._v(" "),s("p",[a._v("PVC和PV是一一对应的，PV和PVC之间的相互作用遵循如下生命周期。")]),a._v(" "),s("ol",[s("li",[a._v("管理员手动创建底层存储和PV。")]),a._v(" "),s("li",[a._v("资源绑定：用户创建PVC，Kubernetes负者根据PVC声明去寻找PV，并绑定在用户定义好的PVC上。如果找不到，PVC就会无限期的处于Pending状态，直到管理员创建一个符合要求的PV。")]),a._v(" "),s("li",[a._v("资源使用：用户可以在Pod中像volume一样使用PVC，Pod使用Volume的定义，将PVC挂载到容器内的某个路径进行使用。")]),a._v(" "),s("li",[a._v("资源释放：用户删除PVC来释放PV。当存储资源使用完毕后，用户可以删除PVC，和该PVC绑定的PV将会被标记为”已释放“，但是还不能立即和其他的PVC进行绑定。通过之前PVC写入的数据可能还留在存储设备上，只有在清除之后该PV才能再次使用。")]),a._v(" "),s("li",[a._v("资源回收：Kubernetes根据PV设置的回收策略进行回收")])]),a._v(" "),s("h2",{attrs:{id:"_3-5-创建pvc后一直绑定不了pv可能得原因"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-创建pvc后一直绑定不了pv可能得原因"}},[a._v("#")]),a._v(" 3.5 创建PVC后一直绑定不了PV可能得原因")]),a._v(" "),s("ul",[s("li",[a._v("PVC的空间申请大小比PV的空间要大。")]),a._v(" "),s("li",[a._v("PVC的storageClassName和PV的storageClassName不一致。")]),a._v(" "),s("li",[a._v("PVC的accessModes和PV的accessModes不一致。")])]),a._v(" "),s("h1",{attrs:{id:"_4-配置存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置存储"}},[a._v("#")]),a._v(" 4 配置存储")]),a._v(" "),s("h2",{attrs:{id:"_4-1-configmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-configmap"}},[a._v("#")]),a._v(" 4.1 ConfigMap")]),a._v(" "),s("p",[a._v("ConfigMap是一个比较特殊的存储卷，它的主要作用是用来存储配置信息的。如果更新了ConfigMap中的内容，容器中的值也会动态更新。")]),a._v(" "),s("h3",{attrs:{id:"_4-1-1-configmap资源清单文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-1-configmap资源清单文件"}},[a._v("#")]),a._v(" 4.1.1 ConfigMap资源清单文件")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ConfigMap\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" configMap\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# <map[string]string>")]),a._v("\n  xxx\n")])])]),s("h3",{attrs:{id:"_4-1-2-创建configmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-2-创建configmap"}},[a._v("#")]),a._v(" 4.1.2 创建ConfigMap")]),a._v(" "),s("p",[s("strong",[a._v("创建configmap.yaml文件：")])]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ConfigMap\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" configmap\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    username"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("admin\n    password"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v("\n")])])]),s("p",[s("strong",[a._v("创建ConfigMap：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" configmap.yaml\n")])])]),s("h3",{attrs:{id:"_4-1-3-创建pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-3-创建pod"}},[a._v("#")]),a._v(" 4.1.3 创建Pod")]),a._v(" "),s("p",[s("strong",[a._v("创建pod-configmap.yaml文件：")])]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" pod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("configmap\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("1.17.1\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumeMounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mountPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /configmap/config\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" config\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" config\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("configMap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" configmap\n")])])]),s("p",[s("strong",[a._v("创建Pod：")])]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[a._v("kubectl create "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("f pod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("configmap.yaml\n")])])]),s("h3",{attrs:{id:"_4-1-4-查看pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-4-查看pod"}},[a._v("#")]),a._v(" 4.1.4 查看Pod")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl get pod pod-configmap "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" dev\n")])])]),s("h3",{attrs:{id:"_4-1-5-进入容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-5-进入容器"}},[a._v("#")]),a._v(" 4.1.5 进入容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" pod-configmap "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" dev /bin/sh\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /configmap/config "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("more")]),a._v(" info\n")])])]),s("h2",{attrs:{id:"_4-2-secret"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-secret"}},[a._v("#")]),a._v(" 4.2 Secret")]),a._v(" "),s("p",[a._v("在kubernetes中，还存在一种和ConfigMap非常类似的对象，称为Secret对象，它主要用来存储敏感信息，例如密码、密钥、证书等等。")]),a._v(" "),s("h3",{attrs:{id:"_4-2-1-准备数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-准备数据"}},[a._v("#")]),a._v(" 4.2.1 准备数据")]),a._v(" "),s("p",[s("strong",[a._v("使用base64对数据进行编码：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 准备username")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"admin"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" base64\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"123456"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" base64\n")])])]),s("h3",{attrs:{id:"_4-2-2-创建secret"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2-创建secret"}},[a._v("#")]),a._v(" 4.2.2 创建Secret")]),a._v(" "),s("p",[s("strong",[a._v("创建secret.yaml文件：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("apiVersion: v1\nkind: Secret\nmetadata:\n  name: secret\n  namespace: dev\ntype: Opaque\ndata:\n  username: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("YWRtaW4")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("\n  password: MTIzNDU2\n")])])]),s("p",[s("strong",[a._v("创建Secret：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" secret.yaml\n")])])]),s("p",[s("strong",[a._v("上面的方式是手动进行编码，也可以直接编写，交给Kubernetes来编码：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("apiVersion: v1\nkind: Secret\nmetadata:\n  name: secret\n  namespace: dev\ntype: Opaque\nstringData:\n  username: admin\n  password: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v("\n")])])]),s("blockquote",[s("p",[a._v("如果同时使用data和stringData，那么data会被忽略。")])]),a._v(" "),s("h3",{attrs:{id:"_4-2-3-查看secret详情"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-3-查看secret详情"}},[a._v("#")]),a._v(" 4.2.3 查看Secret详情")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl describe secret secret "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" dev\n")])])]),s("h3",{attrs:{id:"_4-2-4-创建pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-4-创建pod"}},[a._v("#")]),a._v(" 4.2.4 创建Pod")]),a._v(" "),s("p",[s("strong",[a._v("创建pod-secret.yaml文件")]),a._v("：")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" pod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("secret\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" dev\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("1.17.1\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumeMounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mountPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /secret/config\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" config\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" config\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("secret")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("secretName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" secret\n")])])]),s("p",[s("strong",[a._v("创建Pod：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" pod-secret.yaml\n")])])]),s("h3",{attrs:{id:"_4-2-5查看pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-5查看pod"}},[a._v("#")]),a._v(" 4.2.5查看Pod")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl get pod pod-secret "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" dev\n")])])]),s("h3",{attrs:{id:"_4-2-6-进入容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-6-进入容器"}},[a._v("#")]),a._v(" 4.2.6 进入容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" pod-secret "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" dev /bin/sh\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("ls /secret/config\n")])])]),s("h3",{attrs:{id:"_4-2-7-secret的用途"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-7-secret的用途"}},[a._v("#")]),a._v(" 4.2.7 Secret的用途")]),a._v(" "),s("p",[a._v("imagePullSecret：Pod拉取私有镜像仓库的时候使用的账户密码，会传递给kubectl，然后kubectl就可以拉取有密码的仓库镜像。\n"),s("strong",[a._v("创建一个imagePullSecret：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create secret docker-registry docker-harbor-registrykey --docker-server"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".18.119:85 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n          --docker-username"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("admin --docker-password"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("Harbor12345 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n          --docker-email"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1900919313")]),a._v("@qq.com\n")])])]),s("p",[s("strong",[a._v("查看是否创建成功：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl get secret docker-harbor-registrykey\n")])])]),s("p",[s("strong",[a._v("新建redis.yaml文件：")])]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" redis\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" redis\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 192.168.18.119"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("85/yuncloud/redis "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 这是Harbor的镜像私有仓库地址")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("imagePullSecrets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("harbor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("registrykey\n")])])]),s("p",[s("strong",[a._v("创建Pod：")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" redis.yaml\n")])])]),s("h2",{attrs:{id:"_4-3-configmap高级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-configmap高级"}},[a._v("#")]),a._v(" 4.3 ConfigMap高级")]),a._v(" "),s("p",[a._v("在ConfigMap基础中，我们已经可以实现创建ConfigMap了，但是如果实际工作中这样使用，就会显得很繁琐。")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create configmap "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("map-name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("data-source"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("h3",{attrs:{id:"_4-3-1-从一个目录中创建configmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-从一个目录中创建configmap"}},[a._v("#")]),a._v(" 4.3.1 从一个目录中创建ConfigMap")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-pv")]),a._v(" configure-pod-container/configmap/\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://kubernetes.io/examples/configmap/game.properties "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-O")]),a._v(" configure-pod-container/configmap/game.properties\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://kubernetes.io/examples/configmap/ui.properties "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-O")]),a._v(" configure-pod-container/configmap/ui.properties\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create configmap cm1 --from-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("configure-pod-container/configmap/\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl get cm cm1 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" yaml\n")])])]),s("h3",{attrs:{id:"_4-3-2-从一个文件中创建configmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-2-从一个文件中创建configmap"}},[a._v("#")]),a._v(" 4.3.2 从一个文件中创建ConfigMap")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 默认情况下的key的名称是文件的名称")]),a._v("\nkubectl create configmap cm2 --from-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("configure-pod-container/configmap/game.properties\n")])])]),s("h3",{attrs:{id:"_4-3-3-从一个文件中创建configmap-并自定义configmap中key的名称"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-3-从一个文件中创建configmap-并自定义configmap中key的名称"}},[a._v("#")]),a._v(" 4.3.3 从一个文件中创建ConfigMap，并自定义ConfigMap中key的名称")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create configmap cm3 --from-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("cm3"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("configure-pod-container/configmap/game.properties\n")])])]),s("h3",{attrs:{id:"_4-3-4-从环境变量文件创建configmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-4-从环境变量文件创建configmap"}},[a._v("#")]),a._v(" 4.3.4 从环境变量文件创建ConfigMap")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" configure-pod-container/configmap/env-file.properties\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 语法规则:")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   env 文件中的每一行必须为 VAR = VAL 格式。")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   以＃开头的行(即注释)将被忽略。")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   空行将被忽略。")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#   引号没有特殊处理(即它们将成为 ConfigMap 值的一部分)")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("enemies")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("aliens\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("lives")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("allowed")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"true"')]),a._v("\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create cm cm4 --from-env-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("configure-pod-container/configmap/env-file.properties\n")])])]),s("h3",{attrs:{id:"_4-3-5-在命令行根据键值对创建configmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-5-在命令行根据键值对创建configmap"}},[a._v("#")]),a._v(" 4.3.5 在命令行根据键值对创建ConfigMap")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create configmap cm5 --from-literal"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("special.how"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("very --from-literal"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("special.type"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("charm\n")])])]),s("h3",{attrs:{id:"_4-3-6-使用configmap定义容器环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-6-使用configmap定义容器环境变量"}},[a._v("#")]),a._v(" 4.3.6 使用ConfigMap定义容器环境变量")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create configmap cm6 --from-literal"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("special.how"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("very --from-literal"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("special.type"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("charm\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" test-pod.yaml\n")])])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("container\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" busybox\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/bin/sh"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-c"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"env"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 定义环境变量")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" SPECIAL_LEVEL_KEY\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("valueFrom")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("configMapKeyRef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n              "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ConfigMap的名称")]),a._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" cm6\n              "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ConfigMap的key")]),a._v("\n              "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" special.how\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restartPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Never\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" test-pod.yaml\n")])])]),s("h3",{attrs:{id:"_4-3-7-将-configmap-中的所有键值对配置为容器环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-7-将-configmap-中的所有键值对配置为容器环境变量"}},[a._v("#")]),a._v(" 4.3.7 将 ConfigMap 中的所有键值对配置为容器环境变量")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create configmap cm7 --from-literal"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("special.how"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("very --from-literal"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("special.type"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("charm\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" test-pod.yaml\n")])])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("container\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" busybox\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/bin/sh"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-c"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"env"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("envFrom")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("configMapRef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" cm7\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restartPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Never\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" test-pod.yaml\n")])])]),s("h3",{attrs:{id:"_4-3-8-使用存储在-configmap-中的数据填充容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-8-使用存储在-configmap-中的数据填充容器"}},[a._v("#")]),a._v(" 4.3.8 使用存储在 ConfigMap 中的数据填充容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create configmap cm8 --from-literal"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("special.how"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("very --from-literal"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("special.type"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("charm\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" test-pod.yaml\n")])])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("container\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" busybox\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/bin/sh"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-c"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"ls /etc/config/"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumeMounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("volume\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mountPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /etc/config\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("volume\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("configMap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# configMap的名称")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" cm8\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restartPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Never\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" test-pod.yaml\n")])])]),s("h2",{attrs:{id:"_4-4-configmap-secret使用subpath解决目录覆盖问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-configmap-secret使用subpath解决目录覆盖问题"}},[a._v("#")]),a._v(" 4.4 ConfigMap&&Secret使用SubPath解决目录覆盖问题")]),a._v(" "),s("p",[a._v("ConfigMap和Secret在进行目录挂载的时候会覆盖目录，我们可以使用SubPath解决这个问题。")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建一个Pod")]),a._v("\nkubectl run nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--image")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("nginx:1.17.1\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 将nginx.conf导出到本地")]),a._v("\nkubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" nginx -- "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /etc/nginx/nginx.conf "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" nginx.conf\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建ConfigMap")]),a._v("\nkubectl create cm nginx-conf --from-file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("nginx.conf\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl delete pod nginx\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" nginx.yaml\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  containers:\n    - name: nginx\n      image: nginx:1.17.1\n      command: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/bin/sh"')]),a._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-c"')]),a._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"sleep 3600"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n      volumeMounts:\n      - name: nginx-conf\n        mountPath: /etc/nginx\n  volumes:\n    - name: nginx-conf\n      configMap:\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# configMap的名称")]),a._v("\n        name: nginx-conf\n  restartPolicy: Never\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" nginx.yaml\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" nginx -- "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" /etc/nginx\n")])])]),s("p",[a._v("目录下除了nginx.conf其他文件都没有了。")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" nginx.yaml\n")])])]),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Pod\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("1.17.1\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/bin/sh"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-c"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"sleep 3600"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumeMounts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("conf\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mountPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /etc/nginx/nginx.conf\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("subPath")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx.conf "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# subPath：要覆盖文件的相对路径")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("conf\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("configMap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# configMap的名称")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("conf\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("items")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n         "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx.conf "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# key：ConfigMap中的key的名称")]),a._v("\n           "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("path")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx.conf "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 此处的path相当于 mv nginx.conf nginx.conf")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restartPolicy")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Never\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" nginx.yaml\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" nginx -- "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" /etc/nginx\n")])])]),s("h2",{attrs:{id:"_4-5-configmap-secret的热更新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-configmap-secret的热更新"}},[a._v("#")]),a._v(" 4.5 ConfigMap&&Secret的热更新")]),a._v(" "),s("p",[a._v("注意事项：如果ConfigMap和Secret是以subPath的形式挂载的，那么Pod是不会感知到ConfigMap和Secret的更新的。如果Pod的变量来自ConfigMap和Secret中定义的内容，那么ConfigMap和Secret更新后，也不会更新Pod中的变量。")])])}),[],!1,null,null,null);s.default=n.exports}}]);