(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{321:function(a,s,t){"use strict";t.r(s);var e=t(13),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"_1-docker-compose概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker-compose概念"}},[a._v("#")]),a._v(" 1 docker-compose概念")]),a._v(" "),s("p",[a._v("通过前面的讲解我们知道使用一个Dockerfile模板文件，可以很方便地定义一个单独的应用容器。然 而，在日常工作中， 经常会碰到需要多个容器相互配合来完成某项任务的情况。例如要实现一个Web 项目，除了Web服务容器本身，往往还需要再加上后端的数据库服务容器，甚至还包括负载均衡容器等。\nCompose定位是“定义和运行多个Docker容器的应用”，它允许用户通过一个单独的docker-compose.yml模板文件（YAML格式）来定义一组相关联的应用容器为一个项目（project）。\nDocker Compose 将所管理的容器分为三层，分别是项目（project）、服务（service）、容器（container）")]),a._v(" "),s("ul",[s("li",[a._v("项目（project）：由一组关联的应用容器组成的一个完整业务单元，在docker-compose.yml文件 中定义")]),a._v(" "),s("li",[a._v("服务（service）：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例")]),a._v(" "),s("li",[a._v("容器（container）：docker容器")])]),a._v(" "),s("p",[a._v("Docker Compose 运行目录下的所有文件（docker-compose.yml）组成一个项目,一个项目包含多个服务，每个服务中定义了容器运行的镜像、参数、依赖，一个服务可包括多个容器实例\nCompose的默认管理对象是项目，通过子命令对项目中的一组容器进行便捷地生命周期管理。\nCompose项目由Python编写，实现上调用了Docker服务提供的API来对容器进行管理。因此，只要所操作的平台支持Docker API，就可以在其上利用Compose来进行编排管理。")]),a._v(" "),s("h1",{attrs:{id:"_2-docker-compose安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-docker-compose安装"}},[a._v("#")]),a._v(" 2 docker-compose安装")]),a._v(" "),s("h2",{attrs:{id:"_2-1-下载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-下载"}},[a._v("#")]),a._v(" 2.1 下载")]),a._v(" "),s("p",[a._v("运行以下命令以下载Docker Compose的当前稳定版本：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#$(uname -s)-$(uname -m) : Linux-x86_64")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://github.com/docker/compose/releases/download/1.26.0/dockercompose-'),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("-"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v('"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" /usr/local/bin/docker-compose\n")])])]),s("h2",{attrs:{id:"_2-2-修改执行权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-修改执行权限"}},[a._v("#")]),a._v(" 2.2 修改执行权限")]),a._v(" "),s("p",[a._v("将可执行权限应用于二进制文件：")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x /usr/local/bin/docker-compose\n")])])]),s("h2",{attrs:{id:"_2-3-添加到环境中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-添加到环境中"}},[a._v("#")]),a._v(" 2.3 添加到环境中")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#ln -s ： 软链接")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ln")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" /usr/local/bin/docker-compose /usr/bin/docker-compose\n")])])]),s("h2",{attrs:{id:"_2-4-测试安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-测试安装"}},[a._v("#")]),a._v(" 2.4 测试安装")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v("\n")])])]),s("h2",{attrs:{id:"_2-5-卸载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-卸载"}},[a._v("#")]),a._v(" 2.5 卸载")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" /usr/local/bin/docker-compose\n")])])]),s("h1",{attrs:{id:"_3-docker-compose-yml模板"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-docker-compose-yml模板"}},[a._v("#")]),a._v(" 3 docker-compose.yml模板")]),a._v(" "),s("p",[a._v("模板文件是使用Compose的核心，默认的模板文件名称为docker-compose.yml，格式为YAML格式。")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'2.0'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#版本2.0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#定义服务")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nginx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#Nginx容器")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("1.18.0 "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#Nginx:latest 镜像 先拉镜像 指定镜像的版本")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token datetime number"}},[a._v("80:80")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#映射端口")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 433"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("433")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#挂载数据 宿主机目录（一定要存在）:容器的目录")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" /data/log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/var/log/nginx\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" /data/www"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/var/www\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" /etc/letsencrypt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/etc/letsencrypt\n")])])]),s("h2",{attrs:{id:"_3-1-常见指令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-常见指令"}},[a._v("#")]),a._v(" 3.1 常见指令")]),a._v(" "),s("h3",{attrs:{id:"_3-1-1-version"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-version"}},[a._v("#")]),a._v(" 3.1.1 version")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("version: '2.0' #版本2.0 与swarm结合 要3.0以上\n")])])]),s("h3",{attrs:{id:"_3-1-2-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-service"}},[a._v("#")]),a._v(" 3.1.2 Service")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("services: #定义服务\n")])])]),s("h3",{attrs:{id:"_3-1-3-image"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-image"}},[a._v("#")]),a._v(" 3.1.3 image")]),a._v(" "),s("p",[a._v("image:指定服务的镜像名称或镜像 ID。如果镜像在本地不存在，Compose 将会拉取镜像")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("image: nginx #Nginx:latest 镜像 先拉镜像 指定镜像的版本\n")])])]),s("h3",{attrs:{id:"_3-1-4-ports"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-4-ports"}},[a._v("#")]),a._v(" 3.1.4 ports")]),a._v(" "),s("p",[a._v("ports:端口映射 HOST:CONTAINER")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("ports:\n  - 8000:80 #映射端口\n")])])]),s("h3",{attrs:{id:"_3-1-5-build"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-5-build"}},[a._v("#")]),a._v(" 3.1.5 build")]),a._v(" "),s("p",[a._v("build: 指定dockerfile，Compose 将会利用它自动构建这个镜像，然后使用这个镜像启动服务容器 构建自己的应用")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("build: /path/dockerfilename\nbuild:./path/dockerfilename\n")])])]),s("h3",{attrs:{id:"_3-1-6-command"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-6-command"}},[a._v("#")]),a._v(" 3.1.6 command")]),a._v(" "),s("p",[a._v("command：使用 command 可以覆盖容器启动后默认执行的命令")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('command:echo $HOME\ncommand:[ "echo", "$HOME" ]\ncommand: redis-server /usr/local/etc/redis/redis.conf #先创建目录和文件\n')])])]),s("h3",{attrs:{id:"_3-1-7-启动顺序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-7-启动顺序"}},[a._v("#")]),a._v(" 3.1.7 启动顺序")]),a._v(" "),s("p",[a._v("depends_on：确定容器的启动顺序")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("depends_on:\n- db #服务名\n- redis\n")])])]),s("h3",{attrs:{id:"_3-1-8-environment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-8-environment"}},[a._v("#")]),a._v(" 3.1.8 environment")]),a._v(" "),s("p",[a._v("environment：设置镜像变量")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("environment:\n  RACK_ENV: development\n  SHOW: 'true'\n  SESSION_SECRET:\n")])])]),s("h3",{attrs:{id:"_3-1-9-volumes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-9-volumes"}},[a._v("#")]),a._v(" 3.1.9 volumes")]),a._v(" "),s("p",[a._v("volumes：挂载一个目录或者一个已存在的数据卷容器，可以直接使用 [HOST:CONTAINER] 这样的格 式，或者使用 [HOST:CONTAINER:ro] 这样的格式，后者对于容器来说，数据卷是只读的，这样可以有效保护宿主机的文件系统Compose的数据卷指定路径可以是绝对路径或相对路径")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("volumes: #挂载数据\n  - /data/nginx/conf.d:/etc/nginx/conf.d # 如果不写将使用默认\n  - /data/log:/var/log/nginx\n  - /data/www:/var/www\n")])])]),s("h3",{attrs:{id:"_3-1-10-网络"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-10-网络"}},[a._v("#")]),a._v(" 3.1.10 网络")]),a._v(" "),s("ul",[s("li",[a._v("network_mode：网络模式")]),a._v(" "),s("li",[a._v("networks：定义网络")])]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 默认网络")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" bridge\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#自定义网络")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("front")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" bridge\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("back")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" bridge\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver_opts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("foo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1"')]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("bar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"2"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#使用现有网络")]),a._v("\ndocker network create net"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("a "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("driver bridge\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("external")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" net"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("a\n")])])]),s("h2",{attrs:{id:"_3-2-案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-案例"}},[a._v("#")]),a._v(" 3.2 案例")]),a._v(" "),s("h3",{attrs:{id:"_3-2-1-编写docker-compose模版"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-编写docker-compose模版"}},[a._v("#")]),a._v(" 3.2.1 编写docker-compose模版")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"2.0"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nginx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("1.18.0\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" TZ=Asia/beijing\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token datetime number"}},[a._v("80:80")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 443"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" /docker/nginx/log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/var/log/nginx\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" /docker/nginx/www"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/etc/nginx/html\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" /etc/letsencrypt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/etc/letsencrypt\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("mysql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("5.7.30\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" mysql5.7\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 13306"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3306")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("default"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("authentication"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("plugin=mysql_native_password\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("character"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("set"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("server=utf8mb4\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("collation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("server=utf8mb4_general_ci\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("explicit_defaults_for_timestamp=true\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("lower_case_table_names=1\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("default"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("zone=+8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("00")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"root"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/docker/mysql/db:/var/lib/mysql"')]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("5.0.9\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" TZ=Asia/beijing\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 6379"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6379")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" /docker/redis/data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/data\n")])])]),s("h3",{attrs:{id:"_3-2-2-运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-运行"}},[a._v("#")]),a._v(" 3.2.2 运行")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" up "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## -d 后台启动")]),a._v("\n")])])]),s("h3",{attrs:{id:"_3-2-3-后台运行指定yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-后台运行指定yml"}},[a._v("#")]),a._v(" 3.2.3 后台运行指定yml")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" mysql.yml up "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## -f 指定yml")]),a._v("\n")])])]),s("h3",{attrs:{id:"_3-2-4-查看"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-查看"}},[a._v("#")]),a._v(" 3.2.4 查看")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v("\n")])])]),s("h1",{attrs:{id:"_4-docker-compose常见命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-docker-compose常见命令"}},[a._v("#")]),a._v(" 4 docker-compose常见命令")]),a._v(" "),s("h2",{attrs:{id:"_4-1-ps-列出所有运行容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-ps-列出所有运行容器"}},[a._v("#")]),a._v(" 4.1 ps：列出所有运行容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v("\n")])])]),s("h2",{attrs:{id:"_4-2-logs-查看服务日志输出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-logs-查看服务日志输出"}},[a._v("#")]),a._v(" 4.2 logs：查看服务日志输出")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" logs\n")])])]),s("h2",{attrs:{id:"_4-3-port-打印绑定的公共端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-port-打印绑定的公共端口"}},[a._v("#")]),a._v(" 4.3 port：打印绑定的公共端口")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" port nginx "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("\n")])])]),s("h2",{attrs:{id:"_4-4-build-构建或者重新构建服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-build-构建或者重新构建服务"}},[a._v("#")]),a._v(" 4.4 build：构建或者重新构建服务")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" build\n")])])]),s("h2",{attrs:{id:"_4-5-start-启动指定服务已存在的容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-start-启动指定服务已存在的容器"}},[a._v("#")]),a._v(" 4.5 start：启动指定服务已存在的容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" start nginx\n")])])]),s("h2",{attrs:{id:"_4-6-stop-停止已运行的服务的容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-stop-停止已运行的服务的容器"}},[a._v("#")]),a._v(" 4.6 stop：停止已运行的服务的容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" stop nginx\n")])])]),s("h2",{attrs:{id:"_4-7-rm-删除指定服务的容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-rm-删除指定服务的容器"}},[a._v("#")]),a._v(" 4.7 rm：删除指定服务的容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" nginx\n")])])]),s("h2",{attrs:{id:"_4-8-up-启动服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-8-up-启动服务"}},[a._v("#")]),a._v(" 4.8 up：启动服务")]),a._v(" "),s("p",[a._v("up：通过docker-compose.yml，自动完成包括构建镜像，（重新）创建服务，启动服务，并关联服务 相关容器的一系列操作")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" up "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v("\n")])])]),s("h2",{attrs:{id:"_4-9-run-在一个服务上执行一个命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-9-run-在一个服务上执行一个命令"}},[a._v("#")]),a._v(" 4.9 run：在一个服务上执行一个命令")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" run nginx "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n")])])]),s("h2",{attrs:{id:"_4-10-down-停止并删除容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-10-down-停止并删除容器"}},[a._v("#")]),a._v(" 4.10 down 停止并删除容器")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" down\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);