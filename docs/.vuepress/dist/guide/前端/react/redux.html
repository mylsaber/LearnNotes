<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基础知识 | 迪</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="迪的文档">
    
    <link rel="preload" href="/assets/css/0.styles.2b9f1a15.css" as="style"><link rel="preload" href="/assets/js/app.2f25c357.js" as="script"><link rel="preload" href="/assets/js/2.63c13255.js" as="script"><link rel="preload" href="/assets/js/75.ce1dff6f.js" as="script"><link rel="prefetch" href="/assets/js/10.c7b7d24d.js"><link rel="prefetch" href="/assets/js/11.06f80eba.js"><link rel="prefetch" href="/assets/js/12.6f810a00.js"><link rel="prefetch" href="/assets/js/13.25833528.js"><link rel="prefetch" href="/assets/js/14.4b786116.js"><link rel="prefetch" href="/assets/js/15.abfc377c.js"><link rel="prefetch" href="/assets/js/16.c75b4166.js"><link rel="prefetch" href="/assets/js/17.453f868d.js"><link rel="prefetch" href="/assets/js/18.a490508f.js"><link rel="prefetch" href="/assets/js/19.80524214.js"><link rel="prefetch" href="/assets/js/20.a97ffa51.js"><link rel="prefetch" href="/assets/js/21.547ddc23.js"><link rel="prefetch" href="/assets/js/22.45e85bde.js"><link rel="prefetch" href="/assets/js/23.0dbcaa21.js"><link rel="prefetch" href="/assets/js/24.131b5686.js"><link rel="prefetch" href="/assets/js/25.3d4c262a.js"><link rel="prefetch" href="/assets/js/26.9cbfd763.js"><link rel="prefetch" href="/assets/js/27.542a2792.js"><link rel="prefetch" href="/assets/js/28.fbca4c4d.js"><link rel="prefetch" href="/assets/js/29.9eff63d9.js"><link rel="prefetch" href="/assets/js/3.174213b6.js"><link rel="prefetch" href="/assets/js/30.a6823283.js"><link rel="prefetch" href="/assets/js/31.6a4a92c8.js"><link rel="prefetch" href="/assets/js/32.ce935036.js"><link rel="prefetch" href="/assets/js/33.8771b5d9.js"><link rel="prefetch" href="/assets/js/34.6ef7ae0f.js"><link rel="prefetch" href="/assets/js/35.08fc79cf.js"><link rel="prefetch" href="/assets/js/36.181bec7a.js"><link rel="prefetch" href="/assets/js/37.4e5cdaf9.js"><link rel="prefetch" href="/assets/js/38.f6abaf38.js"><link rel="prefetch" href="/assets/js/39.bc91b61a.js"><link rel="prefetch" href="/assets/js/4.13c31685.js"><link rel="prefetch" href="/assets/js/40.0c43ce82.js"><link rel="prefetch" href="/assets/js/41.4eeb5771.js"><link rel="prefetch" href="/assets/js/42.13baee4d.js"><link rel="prefetch" href="/assets/js/43.2812f396.js"><link rel="prefetch" href="/assets/js/44.87333552.js"><link rel="prefetch" href="/assets/js/45.79925286.js"><link rel="prefetch" href="/assets/js/46.63ec06c7.js"><link rel="prefetch" href="/assets/js/47.31484b65.js"><link rel="prefetch" href="/assets/js/48.61c835fb.js"><link rel="prefetch" href="/assets/js/49.b420b13c.js"><link rel="prefetch" href="/assets/js/5.cbba45ac.js"><link rel="prefetch" href="/assets/js/50.53f11d2b.js"><link rel="prefetch" href="/assets/js/51.1eced69f.js"><link rel="prefetch" href="/assets/js/52.cdb811f6.js"><link rel="prefetch" href="/assets/js/53.18dbb2da.js"><link rel="prefetch" href="/assets/js/54.2f8c7ead.js"><link rel="prefetch" href="/assets/js/55.c17da82b.js"><link rel="prefetch" href="/assets/js/56.ec36758b.js"><link rel="prefetch" href="/assets/js/57.639cf8a7.js"><link rel="prefetch" href="/assets/js/58.848e0216.js"><link rel="prefetch" href="/assets/js/59.89a629cb.js"><link rel="prefetch" href="/assets/js/6.8d81f0ec.js"><link rel="prefetch" href="/assets/js/60.6ee5bb23.js"><link rel="prefetch" href="/assets/js/61.778f8894.js"><link rel="prefetch" href="/assets/js/62.5b79d674.js"><link rel="prefetch" href="/assets/js/63.1f7ab42c.js"><link rel="prefetch" href="/assets/js/64.06670e46.js"><link rel="prefetch" href="/assets/js/65.d55a0cb5.js"><link rel="prefetch" href="/assets/js/66.c0d943d5.js"><link rel="prefetch" href="/assets/js/67.191b831c.js"><link rel="prefetch" href="/assets/js/68.30a1580e.js"><link rel="prefetch" href="/assets/js/69.8a91a673.js"><link rel="prefetch" href="/assets/js/7.2259505f.js"><link rel="prefetch" href="/assets/js/70.8ef61250.js"><link rel="prefetch" href="/assets/js/71.52f9a69a.js"><link rel="prefetch" href="/assets/js/72.4af68aa5.js"><link rel="prefetch" href="/assets/js/73.804ce09d.js"><link rel="prefetch" href="/assets/js/74.0dcbb650.js"><link rel="prefetch" href="/assets/js/76.1c3e5a54.js"><link rel="prefetch" href="/assets/js/77.f0d66982.js"><link rel="prefetch" href="/assets/js/78.436e7214.js"><link rel="prefetch" href="/assets/js/79.900d03e3.js"><link rel="prefetch" href="/assets/js/8.6b054f16.js"><link rel="prefetch" href="/assets/js/80.de0bd2c2.js"><link rel="prefetch" href="/assets/js/9.eeae1cb6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2b9f1a15.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="迪" class="logo"> <span class="site-name can-hide">迪</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/back-end/java/java集合.html" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/guide/前端/JavaScript/ES6.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/guide/other/docker/Docker.html" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="https://www.baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  百度
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/chinese.html" class="nav-link">
  中文
</a></li><li class="dropdown-item"><!----> <a href="/language/english.html" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/guide/back-end/java/java集合.html" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/guide/前端/JavaScript/ES6.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/guide/other/docker/Docker.html" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="https://www.baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  百度
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/chinese.html" class="nav-link">
  中文
</a></li><li class="dropdown-item"><!----> <a href="/language/english.html" class="nav-link">
  English
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>后端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/back-end/java/java集合.html" class="sidebar-link">java集合</a></li><li><a href="/guide/back-end/java/多线程.html" class="sidebar-link">多线程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Docker</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/other/docker/Docker.html" class="sidebar-link">Docker</a></li><li><a href="/guide/other/docker/docker-compose.html" class="sidebar-link">Docker-compose</a></li><li><a href="/guide/other/docker/docker-swarm.html" class="sidebar-link">Docker-swarm</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>Kubernetes</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/other/Kubernetes/1.Kubernetes部署.html" class="sidebar-link">1.Kubernetes部署</a></li><li><a href="/guide/other/Kubernetes/2-Kubernetes资源管理方式.html" class="sidebar-link">2.Kubernetes资源管理方式</a></li><li><a href="/guide/other/Kubernetes/3-Kubernetes的对象.html" class="sidebar-link">3.Kubernetes的对象</a></li><li><a href="/guide/other/Kubernetes/4-Kubernetes的Pod.html" class="sidebar-link">4.Kubernetes的Pod</a></li><li><a href="/guide/other/Kubernetes/5-Kubernetes的控制器.html" class="sidebar-link">5.Kubernetes的控制器</a></li><li><a href="/guide/other/Kubernetes/6-Kubernetes的Service.html" class="sidebar-link">6.Kubernetes的Service</a></li><li><a href="/guide/other/Kubernetes/7-Kubernetes的数据存储.html" class="sidebar-link">7.Kubernetes的数据存储</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/other/Linux/Linux.html" class="sidebar-link">Linux</a></li><li><a href="/guide/other/Linux/Linux基础.html" class="sidebar-link">Linux基础</a></li><li><a href="/guide/other/Linux/Shell脚本.html" class="sidebar-link">Shell脚本</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>项目管理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/other/project-manage/git.html" class="sidebar-link">Git</a></li><li><a href="/guide/other/project-manage/maven.html" class="sidebar-link">Maven</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="基础知识"><a href="#基础知识" class="header-anchor">#</a> 基础知识</h1> <h2 id="redux库和工具"><a href="#redux库和工具" class="header-anchor">#</a> Redux库和工具</h2> <h3 id="react-redux"><a href="#react-redux" class="header-anchor">#</a> React-Redux</h3> <p>Redux可以集成到任何UI框架中，其中最常见的就是React。React-Redux是React官方包，可以让React组件访问state和下发action更新store，从而和Redux集成起来</p> <h3 id="redux-toolkit"><a href="#redux-toolkit" class="header-anchor">#</a> Redux-Toolkit</h3> <p>Redux Toolkit是推荐的编写 Redux 逻辑的方法。 它包含对于构建 Redux 应用程序必不可少的包和函数。 Redux Toolkit 构建在建议的最佳实践中，简化了大多数 Redux 任务，防止了常见错误，并使编写 Redux 应用程序变得更加容易。</p> <h3 id="redux-devtools-扩展"><a href="#redux-devtools-扩展" class="header-anchor">#</a> Redux DevTools 扩展</h3> <p>Redux DevTools 扩展可以显示 Redux 存储中状态随时间变化的历史记录。这允许我们有效地调试应用程序，包括使用强大的技术，如“时间旅行调试”。</p> <h2 id="action"><a href="#action" class="header-anchor">#</a> Action</h2> <p><strong>action</strong>是一个具有<code>type</code>字段的普通JavaScript对象，可以将action视为描述应用程序中发生了什么的事件。</p> <p><code>type</code>字段是一个字符串，给这个action一个描述性的名字，比如<code>&quot;todos/todoAdded&quot;</code>。</p> <p>action对象可以有其他字段，其中包含有关发生的事情的附加信息。按照惯例，将该信息放在<code>payload</code>字段中</p> <p>一个典型的action对象可能如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> addTodoAction <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'todos/todoAdded'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">'Buy milk'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>或者使用函数创建</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'todos/todoAdded'</span><span class="token punctuation">,</span>
    text
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="reducers"><a href="#reducers" class="header-anchor">#</a> Reducers</h2> <p><strong>reducer</strong>是一个函数，接收当前的<code>state</code>和<code>action</code>对象，必要时决定如何更新状态，并返回新状态。函数签名是：<code>(state, action) =&gt; newState</code>，可以将reducer视为一个事件监听器，它根据接收到的action类型处理事件。</p> <p>Reducer必须符合以下规则：</p> <ul><li>仅使用<code>state</code>和<code>action</code>参数计算新的状态值。</li> <li>禁止直接修改<code>state</code>。必须通过复制现有的<code>state</code>并对复制的值进行更改的方式来做***不可变更新（immutable updates）***</li> <li>禁止任何异步逻辑、依赖随机值或导致其他”副作用“的代码</li></ul> <p>reducer函数内部的逻辑通常遵循以下步骤：</p> <ul><li>检查reducer是否关心这个action
<ul><li>如果是，则复制state，使用新值更新state副本，然后返回新state</li></ul></li> <li>否者，返回原来的state不变</li></ul> <p>下面是 reducer 的小例子，展示了每个 reducer 应该遵循的步骤：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">counterReducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> initialState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 检查reducer是否关心这个action</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'counter/increment'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>state<span class="token punctuation">,</span>
      <span class="token comment">//使用新值更新state副本</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> state<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//返回原来的state不变</span>
  <span class="token keyword">return</span> state
<span class="token punctuation">}</span>
</code></pre></div><p>Reducer可以在内部使用任何类型的逻辑来决定新状态应该是什么，如<code>if/else</code>、<code>switch</code>、循环等等。</p> <h2 id="store"><a href="#store" class="header-anchor">#</a> Store</h2> <p>当前Redux应用的状态存在于一个名为store的对象中。</p> <p>store是通过传入一个reducer来创建的，并且有一个名为<code>getState</code>的方法返回当前状态值：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> configureStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@reduxjs/toolkit'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">configureStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">reducer</span><span class="token operator">:</span> conterReducer <span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// {value: 0}</span>
</code></pre></div><h2 id="dispatch"><a href="#dispatch" class="header-anchor">#</a> Dispatch</h2> <p>Redux store有一个方法叫<code>dispatch</code>。<strong>更新state的唯一方法是调用<code>store.dispatch()</code>并传入一个action对象</strong>。store将执行所有的reducer函数并计算出更新后的state。调用<code>getState()</code>可以获取新的state。</p> <div class="language-js extra-class"><pre class="language-js"><code>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'counter/incremented'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// {value: 1}</span>
</code></pre></div><p><strong>dispatch一个action可以形象的理解为”触发一个事件“</strong>。发生了一些事情，我们希望store知道这件事。Reducer就像事件监听器一样。当它们收到关注的action后，就会更新state作为响应。</p> <h2 id="selectors"><a href="#selectors" class="header-anchor">#</a> Selectors</h2> <p>selector函数可以从store状态树中提取指定的片段。随着应用变得越来越大，会遇到应用程序的不同部分需要读取相同的数据，selector可以避免重复这样的读取逻辑。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">selectCounterValue</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>value

<span class="token keyword">const</span> currentValue <span class="token operator">=</span> <span class="token function">selectCounterValue</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>currentValue<span class="token punctuation">)</span>
<span class="token comment">// 2</span>
</code></pre></div><h1 id="核心概念和原则"><a href="#核心概念和原则" class="header-anchor">#</a> 核心概念和原则</h1> <h2 id="单一数据源"><a href="#单一数据源" class="header-anchor">#</a> 单一数据源</h2> <p>应用程序的<strong>全局</strong>状态作为对象存储在单个store中，任何给定的数据片段都应仅存在于一个位置。而不是在许多位置重复。</p> <h2 id="state只读"><a href="#state只读" class="header-anchor">#</a> State只读</h2> <p>更改状态的唯一方法是dispatch一个<strong>action</strong>，这是一个描述所发生情况的对象。</p> <p>这样，UI就不会意外覆盖数据，并且更容易跟踪发生状态跟新的原因。由于action是普通的JavaScript对象，因此可以记录、序列化、存储这些操作，并在以后重放这些操作进行调试或者测试。</p> <h2 id="使用reducer纯函数进行更改"><a href="#使用reducer纯函数进行更改" class="header-anchor">#</a> 使用Reducer纯函数进行更改</h2> <p>若要指定如何基于action跟新状态树，编写<strong>reducer</strong>函数。Reducer是纯函数，它采用state和action，并返回新state。与任何其他函数一样，你可以将Reducer拆分为较小的函数以帮助完成工作。</p> <h2 id="redux数据流"><a href="#redux数据流" class="header-anchor">#</a> Redux数据流</h2> <ul><li>初始启动：
<ul><li>使用最顶层的root reducer函数创建Redux store</li> <li>store调用一次root reducer，并将返回值保存为它的初始<code>state</code></li> <li>当UI首次渲染时，UI组件访问Redux store的当前state，并使用该数据来决定要呈现的内容。同时监听store的更新，以便它们可以知道state是否已更改。</li></ul></li> <li>跟新环节：
<ul><li>应用程序发生了某些事情，例如用户单击按钮。</li> <li>dispatch一个action到Redux store。</li> <li>store用之前的state和当前的action再次运行reducer函数，并将返回值保存为新的state</li> <li>store通知所有订阅过的UI，store发生跟新</li> <li>订阅过store数据的UI组件检查需要的state部分是否更新</li> <li>发现数据被更新的组件使用新数据重新渲染，更新网页</li></ul></li></ul> <h1 id="使用案例"><a href="#使用案例" class="header-anchor">#</a> 使用案例</h1> <h2 id="创建redux-store"><a href="#创建redux-store" class="header-anchor">#</a> 创建Redux store</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> configureStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@reduxjs/toolkit'</span>
<span class="token keyword">import</span> counterReducer <span class="token keyword">from</span> <span class="token string">'../features/counter/counterSlice'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">configureStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">reducer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">counter</span><span class="token operator">:</span> counterReducer
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Redux store是使用Redux Toolkit中的<code>configureStore</code>函数创建的。<code>configureStore</code>要求我们传入一个<code>reducer</code>参数。</p> <p>我们的应用程序可能由许多不同的特性组成，每个特性都可以有自己的reducer函数。当我们调用<code>configureStore</code>时，我们可以传入一个对象中的所有不同的reducer。对象中的键名key将定义最终状态树中的键名key</p> <p>我们有一个名为 <code>features/counter/counterSlice.js</code> 的文件，它为计数器逻辑导出了一个 reducer 函数。 我们可以在此处导入 <code>counterReducer</code> 函数，并在创建 store 时包含它。</p> <p>当我们传入一个像 <code>{counter: counterReducer}</code> 这样的对象时，它表示我们希望在 Redux 状态对象中有一个 <code>state.counter</code> 部分，并且我们希望 <code>counterReducer</code> 函数负责决定是否以及如何在 dispatch action 时更新 <code>state.counter</code> 部分。</p> <p>Redux 允许使用不同类型的插件（“中间件”和“增强器”）自定义 store 设置。<code>configureStore</code> 默认会自动在 store setup 中添加几个中间件以提供良好的开发者体验，并且还设置 store 以便 Redux DevTools Extension 可以检查其内容。</p> <h2 id="redux切片-slice"><a href="#redux切片-slice" class="header-anchor">#</a> Redux切片(Slice)</h2> <p><strong>“切片”是应用中单个功能的 Redux reducer 逻辑和 action 的集合</strong>, 通常一起定义在一个文件中。该名称来自于将根 Redux 状态对象拆分为多个状态“切片”。</p> <p>比如，在一个博客应用中，store 的配置大致长这样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> configureStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@reduxjs/toolkit'</span>
<span class="token keyword">import</span> usersReducer <span class="token keyword">from</span> <span class="token string">'../features/users/usersSlice'</span>
<span class="token keyword">import</span> postsReducer <span class="token keyword">from</span> <span class="token string">'../features/posts/postsSlice'</span>
<span class="token keyword">import</span> commentsReducer <span class="token keyword">from</span> <span class="token string">'../features/comments/commentsSlice'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">configureStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">reducer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">users</span><span class="token operator">:</span> usersReducer<span class="token punctuation">,</span>
    <span class="token literal-property property">posts</span><span class="token operator">:</span> postsReducer<span class="token punctuation">,</span>
    <span class="token literal-property property">comments</span><span class="token operator">:</span> commentsReducer
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>例子中，<code>state.users</code>，<code>state.posts</code>，和 <code>state.comments</code> 均是 Redux state 的一个切片“slice”。由于 <code>usersReducer</code> 负责更新 <code>state.users</code> 切片，我们将其称为“slice reducer”函数。</p> <h2 id="创建slice-reducer和action"><a href="#创建slice-reducer和action" class="header-anchor">#</a> 创建Slice Reducer和Action</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createSlice <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@reduxjs/toolkit'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> counterSlice <span class="token operator">=</span> <span class="token function">createSlice</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'counter'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">initialState</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">reducers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">increment</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Redux Toolkit allows us to write &quot;mutating&quot; logic in reducers. It</span>
      <span class="token comment">// doesn't actually mutate the state because it uses the immer library,</span>
      <span class="token comment">// which detects changes to a &quot;draft state&quot; and produces a brand new</span>
      <span class="token comment">// immutable state based off those changes</span>
      state<span class="token punctuation">.</span>value <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">decrement</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>value <span class="token operator">-=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">incrementByAmount</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>value <span class="token operator">+=</span> action<span class="token punctuation">.</span>payload
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> increment<span class="token punctuation">,</span> decrement<span class="token punctuation">,</span> incrementByAmount <span class="token punctuation">}</span> <span class="token operator">=</span> counterSlice<span class="token punctuation">.</span>actions

<span class="token keyword">export</span> <span class="token keyword">default</span> counterSlice<span class="token punctuation">.</span>reducer
</code></pre></div><p>早些时候，我们看到单击 UI 中的不同按钮会 dispatch 三种不同类型的 Redux action：</p> <ul><li><code>{type: &quot;counter/increment&quot;}</code></li> <li><code>{type: &quot;counter/decrement&quot;}</code></li> <li><code>{type: &quot;counter/incrementByAmount&quot;}</code></li></ul> <p>action是带有<code>type</code>字段的普通对象，<code>type</code>字段总是一个字符串，并且我们通常有action creator函数来创建和返回action对象，</p> <p>每次手写action，繁琐乏味，Redux中真正重要的是reducer函数，以及其中的计算新状态的逻辑。</p> <p>Redux Toolkit有一个名为<code>createSlice</code>的函数，它负者生成action类型字符串、action creator函数和action对象的工作。我们所需要做的就是为这个切片定义一个名称，编写一个包含reducer函数的对象，它会自动生成相应的action代码，<code>name</code>选项的字符串用作每个action类型的第一部分，每个reducer函数的键名用作第二部分，因此：<code>&quot;counter&quot;</code>名称+<code>&quot;increment&quot;</code>reducer函数生成一个action类型<code>{type: &quot;counter/increment&quot;}</code></p> <p>除了<code>name</code>字段，<code>CreateSlice</code>还需要我们为reducer传入初始状态值，以便在第一次调用时就有一个state。这种情况下，我们提供了一个对象，他有一个从0开始的<code>value</code>字段。</p> <p><code>createSlice</code>会自动生成与我们编写的reducer函数同名的action creator。我们可以通过调用其中一个来检查它并查看它返回的内容。</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counterSlice<span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// {type: &quot;counter/increment&quot;}</span>
</code></pre></div><p>它还生成知道如何相应所有这些action类型的slice reducer函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> newState <span class="token operator">=</span> counterSlice<span class="token punctuation">.</span><span class="token function">reducer</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  counterSlice<span class="token punctuation">.</span>actions<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newState<span class="token punctuation">)</span>
<span class="token comment">// {value: 11}</span>
</code></pre></div><h2 id="reducer与不可变更新"><a href="#reducer与不可变更新" class="header-anchor">#</a> Reducer与不可变更新</h2> <p><strong>在Redux中，永远不允许在reducer中更改state的原始对象！</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ✅ 这样操作是安全的，因为创建了副本</span>
<span class="token keyword">return</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>state<span class="token punctuation">,</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">123</span>
<span class="token punctuation">}</span>
</code></pre></div><p>手动编写不可变更新逻辑繁琐，Redux Toolkit的<code>createSlice</code>函数可以让我们以更简单的方式编写不可变更新。</p> <p><code>createSlice</code>内部使用了一个名为Immer的库，使用了一种称为“proxy”的特殊JS工具来包装我们提供的数据。<strong>它会跟踪我们尝试进行的所有更改，然后使用该更改列表返回一个安全的、不可变的更新值</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">incrementByAmount</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   state<span class="token punctuation">.</span>value <span class="token operator">+=</span> action<span class="token punctuation">.</span>payload
<span class="token punctuation">}</span>
</code></pre></div><p>这变得非常易读，但是**只能在Redux Toolkit的<code>createSlice</code>和<code>createReducer</code>中编写“mutation”逻辑。</p> <h2 id="用thunk编写异步逻辑"><a href="#用thunk编写异步逻辑" class="header-anchor">#</a> 用Thunk编写异步逻辑</h2> <p>前面的示例都逻辑都是同步的，首先dispatch action，store调用reducer来计算新状态，然后dispatch函数完成并结束。但是，JavaScript 语言有很多编写异步代码的方法，我们的应用程序通常具有异步逻辑，比如从 API 请求数据之类的事情。我们需要一个地方在我们的 Redux 应用程序中放置异步逻辑。</p> <p><strong>thunk</strong>是一种特定类型的Redux函数，可以包含异步逻辑。Thunk是使用两个函数编写的：</p> <ul><li>一个内部thunk函数，它以<code>dispatch</code>和<code>getState</code>作为参数</li> <li>外部创建者函数，它创建并返回thunk函数</li></ul> <p>从 <code>counterSlice</code> 导出的函数就是一个 thunk action creator 的例子。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// The function below is called a thunk and allows us to perform async logic.</span>
<span class="token comment">// It can be dispatched like a regular action: `dispatch(incrementAsync(10))`.</span>
<span class="token comment">// This will call the thunk with the `dispatch` function as the first argument.</span>
<span class="token comment">// Async code can then be executed and other actions can be dispatched</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">incrementAsync</span> <span class="token operator">=</span> <span class="token parameter">amount</span> <span class="token operator">=&gt;</span> <span class="token parameter">dispatch</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">incrementByAmount</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们可以像使用普通Redux action creator一样使用它们：</p> <div class="language-js extra-class"><pre class="language-js"><code>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">incrementAsync</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>使用thunk需要再创建时将<code>redux-thunk</code>添加到Redux store中，Redux Toolkit的<code>configureStore</code>函数会自动配置好。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 外部的 thunk creator 函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchUserById</span> <span class="token operator">=</span> <span class="token parameter">userId</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 内部的 thunk 函数</span>
  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> getState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// thunk 内发起异步数据请求</span>
      <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> userAPI<span class="token punctuation">.</span><span class="token function">fetchById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
      <span class="token comment">// 但数据响应完成后 dispatch 一个 action</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">userLoaded</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果过程出错，在这里处理</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="react-counter组件"><a href="#react-counter组件" class="header-anchor">#</a> React Counter组件</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useSelector<span class="token punctuation">,</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  decrement<span class="token punctuation">,</span>
  increment<span class="token punctuation">,</span>
  incrementByAmount<span class="token punctuation">,</span>
  incrementAsync<span class="token punctuation">,</span>
  selectCount
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./counterSlice'</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'./Counter.module.css'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span>selectCount<span class="token punctuation">)</span>
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>incrementAmount<span class="token punctuation">,</span> setIncrementAmount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>row<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button
          className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>button<span class="token punctuation">}</span>
          aria<span class="token operator">-</span>label<span class="token operator">=</span><span class="token string">&quot;Increment value&quot;</span>
          onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&gt;</span>
          <span class="token operator">+</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button
          className<span class="token operator">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>button<span class="token punctuation">}</span>
          aria<span class="token operator">-</span>label<span class="token operator">=</span><span class="token string">&quot;Decrement value&quot;</span>
          onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token operator">&gt;</span>
          <span class="token operator">-</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">{</span><span class="token comment">/* 这里省略了额外的 render 代码 */</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>React-Redux库有一组自定义的hooks，允许React组件与Redux store交互</p> <h3 id="useselector提取数据"><a href="#useselector提取数据" class="header-anchor">#</a> <code>useSelector</code>提取数据</h3> <p>这个hooks让我们的组件从Redux的store状态树中提取它需要的任何数据。</p> <p><code>counterSlice.js</code> 在底部有这个 selector 函数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// The function below is called a selector and allows us to select a value from</span>
<span class="token comment">// the state. Selectors can also be defined inline where they're used instead of</span>
<span class="token comment">// in the slice file. For example: `useSelector((state) =&gt; state.counter.value)`</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">selectCount</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>value
</code></pre></div><p>如果我们可以访问 Redux 的 store，我们可以将当前计数器值检索为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">selectCount</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
<span class="token comment">// 0</span>
</code></pre></div><p>我们的组件不能直接与Redux store对话，因为组件文件不能引入store。但是，<code>useSelector</code>负者为我们在幕后与Redux store对话。如果我们传入一个selector函数，它会为我们调用<code>someSelector(store.getState)</code>，并返回结果。</p> <p>因此，我们可以通过执行以下操作来获取store中的计数器值：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span>selectCount<span class="token punctuation">)</span>
</code></pre></div><p>我们也不是只能使用已经导出得selector。例如，我们可以编写一个选择器函数作为<code>useSelector</code>的内联参数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> countPlusTwo <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>counter<span class="token punctuation">.</span>value <span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div><p>每当一个action被dispatch并且Redux store被更新时，<code>useSelector</code>将重新运行我们的选择器函数。如果选择器返回的值与上次不同，<code>useSelector</code>将确保我们的组件使用新值重新渲染。</p> <h3 id="usedispatch来dispatch-action"><a href="#usedispatch来dispatch-action" class="header-anchor">#</a> <code>useDispatch</code>来dispatch action</h3> <p><code>useDispatch</code> hooks为我们提供访问<code>store.dispatch()</code>方法的能力。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="providing-the-store"><a href="#providing-the-store" class="header-anchor">#</a> Providing the Store</h3> <p>我们可以看到我们的组件可以使用<code>useSelector</code>和<code>useDispatch</code>这两个hooks与Redux的store通信，但是我们并没有导入store，那么这些hooks怎么知道要与那个Redux store对话的呢？</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>
<span class="token keyword">import</span> <span class="token string">'./index.css'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./app/store'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> serviceWorker <span class="token keyword">from</span> <span class="token string">'./serviceWorker'</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>我们总是必须调用<code>ReactDOM.render(&lt;App /&gt;)</code>来告诉React开始渲染我们的根<code>&lt;APP&gt;</code>组件，为了让像<code>useSelector</code>这样的hooks正常工作，我们需要使用一个名为<code>&lt;Provider&gt;</code>的组件在幕后传递Redux store</p> <p>我们在这里引用来自<code>app/store.js</code>中创建的sotre。然后，用<code>&lt;Provider&gt;</code>包裹整个<code>&lt;App&gt;</code>，并传入store。</p> <p>现在任何调用<code>useSelector</code>或<code>useDispatch</code>的React组件都可以访问<code>&lt;Provider&gt;</code>中的store</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <ul><li>我们可以使用Redux Toolkit 中<code>configureStore</code>API创建一个Redux store
<ul><li><code>configureStore</code>接收<code>reducer</code>函数来作为命名参数</li> <li><code>configureStore</code>自动使用默认值来配置store</li></ul></li> <li>在slice文件中编写Redux逻辑
<ul><li>一个slice包含一个特定功能或部分的state相关的reducer逻辑和action</li> <li>Redux Toolkit的<code>createSlice</code>API为我们提供的每个reducer函数生成action creator和action类型</li></ul></li> <li>Redux reducer必须遵循以下原则
<ul><li>必须依赖<code>state</code>和<code>action</code>参数去计算出一个新state</li> <li>必须通过拷贝旧state的方式去做***不可变更新(immutable updates)***</li> <li>不能包含任何异步逻辑或其他副作用</li> <li>Redux Toolkit的<code>createSlice</code>API内部使用immer库才达到表面上直接修改state也可以实现不可变更新的效果。</li></ul></li> <li>一般使用“thunks”来开发特定的异步逻辑
<ul><li>Thunks接收<code>dispatch</code>和<code>getState</code>作为参数</li> <li>Redux Toolkit内置并默认启用了<code>redux-thunk</code>中间件</li></ul></li> <li>使用React-Redux来做React组件和Redux store的通信
<ul><li>在应用程序根组件包裹<code>&lt;Provider store={store}&gt;</code>使得所有组件都能访问到store</li> <li>全局状态应该维护在Redux store内，局部状态应该维护在局部React组件内</li></ul></li></ul> <h1 id="api"><a href="#api" class="header-anchor">#</a> API</h1> <h2 id="顶级暴露方法"><a href="#顶级暴露方法" class="header-anchor">#</a> 顶级暴露方法</h2> <h3 id="createstore"><a href="#createstore" class="header-anchor">#</a> createStore</h3> <p>createStore(reducer,[preloadedState],[enhancer])，创建一个Redux store。</p> <p><strong>参数：</strong></p> <ol><li><code>reducer</code>(Function)：接收两个参数，分别是当前的state树和要处理的action，返回新的state树。</li> <li><code>[preloadedState]</code>(any)：初始化时的state。在同构应用中，你可以决定是否把服务端传来的state水合(hydrate)后传给它，或者从之前保存的用户会话中恢复一个传给它。如果你使用<code>combineReducers</code>创建<code>reducer</code>，它必须是一个普通对象，与传入的keys保持同样的结构。</li> <li><code>enhancer</code>(Function)：Store enhancer，可选使用。可以用第三方能力来增强store，是一个组合store creator的高阶函数，返回一个新的强化过的store creator。Redux中唯一内置的store enhander是<code>applyMiddleware()</code></li></ol> <p><strong>返回值：</strong></p> <p><code>store</code>：保存了应用所有state的对象。改变state的唯一方法是dispatch action。你也可以subscribe监听state的变化，然后更新UI</p> <p><strong>示例：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>

<span class="token keyword">function</span> <span class="token function">todos</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'ADD_TODO'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>action<span class="token punctuation">.</span>text<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Use Redux'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ADD_TODO'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'Read the docs'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// [ 'Use Redux', 'Read the docs' ]</span>
</code></pre></div><h3 id="combinereducers"><a href="#combinereducers" class="header-anchor">#</a> combineReducers</h3> <p>combineReducers(reducers)：把一个由多个不同reducer函数作为value的object，合并成一个最终的reducer函数，然后就可以对这个reducer调用<code>createStore</code>方法。</p> <p>合并后的reducer可以调用各个子reducer，并把它们返回的结果合并成一个state对象。<strong>由 <code>combineReducers()</code> 返回的 state 对象，会将传入的每个 reducer 返回的 state 按其传递给 <code>combineReducers()</code> 时对应的 key 进行命名</strong>。</p> <p><strong>参数：</strong></p> <ol><li><code>reducer</code>(Object)：一个对象，他的值(value)对应不同的reducer函数，这些reducer函数后面会被合并成一个。</li></ol> <p><strong>返回值：</strong></p> <p>(Function)：一个调用<code>reducers</code>对象里所有的reducer的reducer，并且构造一个与<code>reducers</code>对象结构相同的state对象</p> <p><strong>示例：</strong></p> <p><code>reducers/todos.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">todos</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'ADD_TODO'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>action<span class="token punctuation">.</span>text<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>reducers/counter.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'INCREMENT'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">'DECREMENT'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>reducers/index.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> todos <span class="token keyword">from</span> <span class="token string">'./todos'</span>
<span class="token keyword">import</span> counter <span class="token keyword">from</span> <span class="token string">'./counter'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  todos<span class="token punctuation">,</span>
  counter
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>App.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducers/index'</span>

<span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   counter: 0,</span>
<span class="token comment">//   todos: []</span>
<span class="token comment">// }</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ADD_TODO'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'Use Redux'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   counter: 0,</span>
<span class="token comment">//   todos: [ 'Use Redux' ]</span>
<span class="token comment">// }</span>
</code></pre></div><h3 id="applymiddleware"><a href="#applymiddleware" class="header-anchor">#</a> applyMiddleware</h3> <p>applyMiddleware(...middlewarees)：使用包含自定义功能的 middleware 来扩展 Redux 是一种推荐的方式。Middleware 可以让你包装 store 的 dispatch 方法来达到你想要的目的。同时， middleware 还拥有“可组合”这一关键特性。多个 middleware 可以被组合到一起使用，形成 middleware 链。其中，每个 middleware 都不需要关心链中它前后的 middleware 的任何信息。</p> <p><strong>参数：</strong></p> <ol><li><code>...middleware</code>(arguments)：遵循 Redux <em>middleware API</em> 的函数。每个 middleware 接受 store 的dispatch 和 getState 入被称为 <code>next</code> 的下一个 middleware 的 dispatch 方法，并返回一个接收 action 的新函数，这个函数可以直接调用 <code>next(action)</code>，或者在其他需要的时刻调用，甚至根本不去调用它。调用链中最后一个 middleware 会接受真实的 store 的 dispatch 方法作为 <code>next</code> 参数，并借此结束调用链。所以，middleware 的函数签名是 <code>({ getState, dispatch }) =&gt; next =&gt; action</code>。</li></ol> <p><strong>返回值：</strong></p> <p>(<em>Function</em>) 一个应用了 middleware 后的 store enhancer。这个 store enhancer 的签名是 <code>createStore =&gt; createStore</code>，但是最简单的使用方法就是直接作为最后一个 <code>enhancer</code> 参数传递给 createStore() 函数。</p> <h3 id="bindactioncreators"><a href="#bindactioncreators" class="header-anchor">#</a> bindActionCreators</h3> <p>bindActionCreators(actionCreators,dispatch)：把一个value为不同action creator的对象，转成拥有同名key的对象，同时使用<code>dispatch</code>对每个action creator进行包装，以便可以直接调用它们。</p> <p><strong>参数：</strong></p> <ol><li><code>actionCreators</code> (<em>Function</em> or <em>Object</em>): 一个 <a href="http://cn.redux.js.org/understanding/thinking-in-redux/glossary#action-creator" target="_blank" rel="noopener noreferrer">action creator<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，或者一个 value 是 action creator 的对象。</li> <li><code>dispatch</code> (<em>Function</em>): 一个由 <a href="http://cn.redux.js.org/api/store" target="_blank" rel="noopener noreferrer"><code>Store</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 实例提供的 <a href="http://cn.redux.js.org/api/store#dispatchaction" target="_blank" rel="noopener noreferrer"><code>dispatch</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 函数。</li></ol> <p><strong>返回值：</strong></p> <p>(<em>Function</em> or <em>Object</em>): 一个与原对象类似的对象，只不过这个对象的 value 都是会直接 dispatch 原 action creator 返回的结果的函数。如果传入一个单独的函数作为 <code>actionCreators</code>，那么返回的结果也是一个单独的函数。</p> <p><strong>示例：</strong></p> <p><code>TodoActionCreators.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'ADD_TODO'</span><span class="token punctuation">,</span>
    text
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">removeTodo</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'REMOVE_TODO'</span><span class="token punctuation">,</span>
    id
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>SomeComponent.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> bindActionCreators <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>

<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> TodoActionCreators <span class="token keyword">from</span> <span class="token string">'./TodoActionCreators'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>TodoActionCreators<span class="token punctuation">)</span>
<span class="token comment">// {</span>
<span class="token comment">//   addTodo: Function,</span>
<span class="token comment">//   removeTodo: Function</span>
<span class="token comment">// }</span>

<span class="token keyword">class</span> <span class="token class-name">TodoListContainer</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>

    <span class="token keyword">const</span> <span class="token punctuation">{</span> dispatch <span class="token punctuation">}</span> <span class="token operator">=</span> props

    <span class="token comment">// 这是一个很好的 bindActionCreators 的使用示例：</span>
    <span class="token comment">// 你想让你的子组件完全不感知 Redux 的存在。</span>
    <span class="token comment">// 我们在这里对 action creator 绑定 dispatch 方法，</span>
    <span class="token comment">// 以便稍后将其传给子组件。</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>boundActionCreators <span class="token operator">=</span> <span class="token function">bindActionCreators</span><span class="token punctuation">(</span>TodoActionCreators<span class="token punctuation">,</span> dispatch<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>boundActionCreators<span class="token punctuation">)</span>
    <span class="token comment">// {</span>
    <span class="token comment">//   addTodo: Function,</span>
    <span class="token comment">//   removeTodo: Function</span>
    <span class="token comment">// }</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 由 react-redux 注入的 dispatch：</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> dispatch <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props

    <span class="token comment">// 注意：这样是行不通的：</span>
    <span class="token comment">// TodoActionCreators.addTodo('Use Redux')</span>

    <span class="token comment">// 你只是调用了创建 action 的方法。</span>
    <span class="token comment">// 你必须要同时 dispatch action。</span>

    <span class="token comment">// 这样做是可行的：</span>
    <span class="token keyword">let</span> action <span class="token operator">=</span> TodoActionCreators<span class="token punctuation">.</span><span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token string">'Use Redux'</span><span class="token punctuation">)</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 由 react-redux 注入的 todos：</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> todos <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props

    <span class="token keyword">return</span> <span class="token operator">&lt;</span>TodoList todos<span class="token operator">=</span><span class="token punctuation">{</span>todos<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>boundActionCreators<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token comment">// 另一替代 bindActionCreators 的做法是</span>
    <span class="token comment">// 直接把 dispatch 函数当作 prop 传递给子组件，但这时你的子组件需要</span>
    <span class="token comment">// 引入 action creator 并且感知它们</span>

    <span class="token comment">// return &lt;TodoList todos={todos} dispatch={dispatch} /&gt;;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">todos</span><span class="token operator">:</span> state<span class="token punctuation">.</span>todos <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>TodoListContainer<span class="token punctuation">)</span>
</code></pre></div><h3 id="compose"><a href="#compose" class="header-anchor">#</a> compose</h3> <p>compose(...functions)：从右到左来组合多个函数，当需要把多个store增强器依次执行的时候，需要用到它。</p> <p><strong>参数：</strong></p> <ol><li>(<em>arguments</em>): 需要合成的多个函数。预计每个函数都接收一个参数。它的返回值将作为一个参数提供给它左边的函数，以此类推。例外是最右边的参数可以接受多个参数，因为它将为由此产生的函数提供签名。（译者注：<code>compose(funcA, funcB, funcC)</code> 形象为 <code>compose(funcA(funcB(funcC())))</code>）</li></ol> <p><strong>返回值：</strong></p> <p>(<em>Function</em>): 从右到左把接收到的函数合成后的最终函数。</p> <p><strong>示例：</strong></p> <p>下面示例演示了如何使用 <code>compose</code> 增强 <a href="http://cn.redux.js.org/api/store" target="_blank" rel="noopener noreferrer">store<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，这个 store 与 <a href="http://cn.redux.js.org/api/applymiddleware" target="_blank" rel="noopener noreferrer"><code>applyMiddleware</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://github.com/reduxjs/redux-devtools" target="_blank" rel="noopener noreferrer">redux-devtools<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 一起使用。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> applyMiddleware<span class="token punctuation">,</span> compose <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> thunk <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span>
<span class="token keyword">import</span> DevTools <span class="token keyword">from</span> <span class="token string">'./containers/DevTools'</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'../reducers'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  reducer<span class="token punctuation">,</span>
  <span class="token function">compose</span><span class="token punctuation">(</span>
    <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">,</span>
    DevTools<span class="token punctuation">.</span><span class="token function">instrument</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><h2 id="store-2"><a href="#store-2" class="header-anchor">#</a> Store</h2> <p>Store就是用来维持应用所有的state树的一个对象。改变store内state的唯一途径就是对它dispatch一个action</p> <p>Store不是类，它只是有几个方法的对象。要创建它，只需要把根部的reducing函数传递给<code>createStore</code>。</p> <h3 id="getstate"><a href="#getstate" class="header-anchor">#</a> getState()</h3> <p>返回应用当前的state树。它与store的最后一个reducer返回值相同</p> <h3 id="dispatch-action"><a href="#dispatch-action" class="header-anchor">#</a> dispatch(action)</h3> <p>分发action。这是触发state变化的唯一途径。</p> <h3 id="subscribe-listener"><a href="#subscribe-listener" class="header-anchor">#</a> subscribe(listener)</h3> <p>添加一个变化监听器。每当dispatch action的时候会执行，state树中的一部分可能已经变化。可以在回调函数里调用<code>getState()</code>来拿到当前的state。</p> <p><strong>参数：</strong></p> <ol><li><code>listener</code> (<em>Function</em>): 每当 dispatch action 的时候都会执行的回调。state 树中的一部分可能已经变化。你可以在回调函数里调用 <a href="http://cn.redux.js.org/api/store#getstate" target="_blank" rel="noopener noreferrer"><code>getState()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来拿到当前 state。store 的 reducer 应该是纯函数，因此你可能需要对 state 树中的引用做深度比较来确定它的值是否有变化。</li></ol> <p><strong>返回值：</strong></p> <p>(<em>Function</em>): 一个可以解绑变化监听器的函数。</p> <p><strong>示例：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> state<span class="token punctuation">.</span>some<span class="token punctuation">.</span>deep<span class="token punctuation">.</span>property
<span class="token punctuation">}</span>

<span class="token keyword">let</span> currentValue
<span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> previousValue <span class="token operator">=</span> currentValue
  currentValue <span class="token operator">=</span> <span class="token function">select</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>previousValue <span class="token operator">!==</span> currentValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
      <span class="token string">'Some deep nested property changed from'</span><span class="token punctuation">,</span>
      previousValue<span class="token punctuation">,</span>
      <span class="token string">'to'</span><span class="token punctuation">,</span>
      currentValue
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>handleChange<span class="token punctuation">)</span>
<span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="replacereducer-nextreducer"><a href="#replacereducer-nextreducer" class="header-anchor">#</a> replaceReducer(nextReducer)</h3> <p>替换store当前用来计算state的reducer。</p> <p>这个一个高级API，只有在你需要实现代码分隔，而且需要立即加载一些reducer的时候才可能会用到它。在实现Redux热加载机制的时候也可能会用到。</p> <p><strong>参数：</strong></p> <ol><li><code>nextReducer</code>(Function)：sotre会使用的下一个reducer</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2f25c357.js" defer></script><script src="/assets/js/2.63c13255.js" defer></script><script src="/assets/js/75.ce1dff6f.js" defer></script>
  </body>
</html>
